---
title: "Weekly CCC Metrics for Modules 1-4"
output:
  pdf_document: default
  word_document: default
---


```{r, include=FALSE, warning=FALSE}
## Have to manually run this section, then you can knit

library(bigrquery)
library(dplyr)
library(gmodels)
library(epiDisplay)
library(lubridate)
library(tidyverse)
library(gt)
library(kableExtra)
library(knitr)
library(gtsummary)
library(tidyr)
#install_tinytex()
library(tinytex)
bq_auth()
#1
```


```{r, include=FALSE}
## CCC WEEKLY METRICS REPORT 



### To run the code, note questions 1,5,6,7, and 8 apply to all modules and questions 2-4 apply individually to each module. Run #1 first, then #2-4 for reach module, then #6-8



##Load Data from BQ

project_cc = "nih-nci-dceg-connect-prod-6d04"
billing_cc= "nih-nci-dceg-connect-prod-6d04"
queryreccc <- "SELECT  Connect_ID, d_512820379, d_821247024, d_914594314, d_832139544, 
d_949302066 , d_205553981, d_536735468 , d_976570371, d_663265240, d_265193023, d_222161762, d_770257102, d_264644252, d_265193023, d_541836531, d_386488297, 
d_452942800, d_517311251 , d_822499427
FROM `nih-nci-dceg-connect-prod-6d04.recruitment.recruitment1_WL` where Connect_ID IS NOT NULL"

rec_table_cc <- bq_project_query(project_cc, queryreccc)
data_c <- bq_table_download(rec_table_cc, bigint = "integer64")

#data_ccc=merge(mod1_data_cc, data_ccc, by="Connect_ID")  #tidyverse has left join

data_ccc <- data_c %>% filter(d_821247024==197316935) #must be verified
dim(data_ccc) #Number of verified participants 

active_c <- data_ccc %>% filter(d_512820379==486306141)
passive_c <- data_ccc %>% filter(d_512820379==854703046)
data_ccc <- data_ccc %>% filter(d_512820379==486306141 | d_512820379==854703046) #must be active or passive
dim(data_ccc)


### Stratify by verified before all modules available in prod and, verified after all modules available in prod ###

started_m1= data_ccc %>%  filter(!is.na(d_205553981) & (d_949302066==615768760 | d_949302066==231311385))  #CID 4201878434 has no start date but completed module 1....
dim(started_m1)

data_ccc_after <- data_ccc %>% filter(!is.na(d_914594314) & d_914594314>=as.Date("2022-07-05"))  #those verified AFTER all modules were available 
dim(data_ccc_after)

data_ccc_before <- data_ccc %>% filter(!is.na(d_914594314) & d_914594314<"2022-07-05") #those verified BEFORE all were available
dim(data_ccc_before)


active_c_after <- data_ccc_after %>% filter(d_512820379==486306141)
dim(active_c_after)
passive_c_after <- data_ccc_after %>% filter(d_512820379==854703046)
dim(passive_c_after)

active_c_before <- data_ccc_before %>% filter(d_512820379==486306141)
dim(active_c_before)
passive_c_before <- data_ccc_before %>% filter(d_512820379==854703046)
dim(passive_c_before)
```


```{r, echo=FALSE}
####TIME STAMP 
currentTime <- Sys.time()
print(currentTime)
```
 

```{r, echo=FALSE}
cat("Verified Participants:", dim(data_ccc)[[1]])
cat("Date all modules available in prod: July 5, 2022")
cat("Verified participants prior to 7/5/22:", dim(data_ccc_before)[[1]])
cat("Verified participants on or after 7/5/22:", dim(data_ccc_after)[[1]])
```


# 1.	% Submission of surveys by verified participants (including impossible scenarios)
# 
### Before all modules available

```{r, include=FALSE}
####### ALL MODULES ########

#1. Survey status of verified participants: None Completed, Some Completed (Combinations), All completed. This includes impossible selections for QC check

##BEFORE ALL AV'L--- run through once with data_tib set to before data first for first startified table
data_tib= as_tibble(data_ccc_before) #HAD TO MAKE A TIBBLE FOR GT() TABLE FUNCTION
head(data_tib)


modules <- data_tib[,c("Connect_ID","d_512820379","d_949302066","d_536735468","d_976570371","d_663265240")] 
mods <- c("d_949302066","d_536735468","d_976570371","d_663265240")
modules$modules <- 0
modules$none <-0
for(i in 1:length(mods)){
  module <- modules[,mods[i]]
  count <- ifelse((!is.na(module) & module ==231311385), 1, 0)
  modules$modules <- count+modules$modules
  count1 <- ifelse((!is.na(module) & module==972455046), 1, 0)
  modules$none <- count1+modules$none
}

table(modules$modules)

table(modules$none)

table(modules$modules,modules$d_949302066)
CrossTable(modules$d_949302066, modules$modules,digits=4, prop.t=FALSE, prop.r=TRUE, prop.c=TRUE,prop.chisq=FALSE)

length(modules[which(modules$modules==3 & modules$d_663265240==231311385 & modules$d_536735468==231311385),])
modules1 <- modules %>% mutate(process=case_when(d_949302066 == 231311385 & modules==1 ~ "module 1 only",
                                                 d_536735468 == 231311385 & modules==1 ~ "module 2 only",
                                                 d_976570371 == 231311385 & modules==1 ~ "module 3 only",
                                                 d_663265240 == 231311385 & modules==1 ~ "module 4 only",
                                                 modules ==2 & d_949302066 == 231311385 & d_536735468 == 231311385 ~ "module 1,2" ,
                                                 modules ==2 & d_949302066 == 231311385 & d_976570371 == 231311385 ~ "module 1,3" ,
                                                 modules ==2 & d_949302066 == 231311385 & d_663265240 == 231311385 ~ "module 1,4" ,
                                                 modules ==2 & d_536735468 == 231311385 & d_976570371 == 231311385 ~ "module 2,3" ,
                                                 modules ==2 & d_536735468 == 231311385 & d_663265240 == 231311385 ~ "module 2,4" ,
                                                 modules ==2 & d_976570371 == 231311385 & d_663265240 == 231311385 ~ "module 3,4" ,
                                                 modules ==3 & d_949302066 == 231311385 & d_536735468 == 231311385 & d_976570371 == 231311385 ~ "module 1,2,3" ,
                                                 modules ==3 & d_949302066 == 231311385 & d_976570371 == 231311385 & d_663265240 == 231311385~ "module 1,3,4" ,
                                                 modules ==3 & d_949302066 == 231311385 & d_536735468 == 231311385 & d_663265240 == 231311385 ~ "module 1,2,4",
                                                 modules ==3 & d_536735468 == 231311385 & d_976570371 == 231311385 & d_663265240 == 231311385 ~ "module 2,3,4" ,
                                                 modules ==0 ~ "None",
                                                 modules ==4 ~ "All"))
table(modules1$process)
tab1(modules1$process, decimal=2,sort.group = "decreasing", cum.percent = TRUE)$output.table

##MAKE INTO A PRESENTABLE TABLE:

#### ran this part before but now may not need to?
# modules1 <-as_gt(modules1) ##THIS WAS WORKING BEFORE!! WHY NOT ANYMORE?!
# head(modules1)

ccc1= modules1 %>%  mutate(freq=if(!is.na(modules1$Connect_ID)){1})
head(ccc1)
dim(ccc1)[[1]]

ccc1$percentage= (ccc1$freq/dim(ccc1)[[1]])*100 
head(ccc1)

dt <- ccc1[ , c(9,10, 11)] #want only frequency, process and percentage of participants 
head(dt)



dt_summary <- dt %>%  group_by(process) %>% summarize_at(c("freq", "percentage"), sum, na.rm = TRUE) #%>% 
#gather("process", -freq) #not allowing decreasing frequency
gt_print <- gt(dt_summary)
gt_print



```

```{r, echo=FALSE}
#Make the automated table
dt_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = html("Verified Participants Survey Completion")) %>% 
  tab_footnote(
    footnote = "This includes impossible scenarios: Modules 2, 3, and/or 4 being completed without Module 1 first completed. Only scenarios that have occured will show on this table.") %>%
  cols_label(process = md("**Modules Completed**"), freq = md("**Number of participants (n)**"), percentage = md("**Percentage of Participants**")) %>% 
  summary_rows(
    columns = c(freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = process,
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "gray90"),
      locations = cells_body(
      rows = c(1,3,5,7,9)
    )
  ) %>%  opt_row_striping()
```

### On or After all modules available

```{r, include=FALSE}
##AFTER ALL AV'L--- then run through again with data tib set to after data for second straitified table
data_tib= as_tibble(data_ccc_after) #HAD TO MAKE A TIBBLE FOR GT() TABLE FUNCTION
head(data_tib)

modules <- data_tib[,c("Connect_ID","d_512820379","d_949302066","d_536735468","d_976570371","d_663265240")] 
mods <- c("d_949302066","d_536735468","d_976570371","d_663265240")
modules$modules <- 0
modules$none <-0
for(i in 1:length(mods)){
  module <- modules[,mods[i]]
  count <- ifelse((!is.na(module) & module ==231311385), 1, 0)
  modules$modules <- count+modules$modules
  count1 <- ifelse((!is.na(module) & module==972455046), 1, 0)
  modules$none <- count1+modules$none
}

table(modules$modules)

table(modules$none)

table(modules$modules,modules$d_949302066)
CrossTable(modules$d_949302066, modules$modules,digits=4, prop.t=FALSE, prop.r=TRUE, prop.c=TRUE,prop.chisq=FALSE)

length(modules[which(modules$modules==3 & modules$d_663265240==231311385 & modules$d_536735468==231311385),])
modules1 <- modules %>% mutate(process=case_when(d_949302066 == 231311385 & modules==1 ~ "module 1 only",
                                                 d_536735468 == 231311385 & modules==1 ~ "module 2 only",
                                                 d_976570371 == 231311385 & modules==1 ~ "module 3 only",
                                                 d_663265240 == 231311385 & modules==1 ~ "module 4 only",
                                                 modules ==2 & d_949302066 == 231311385 & d_536735468 == 231311385 ~ "module 1,2" ,
                                                 modules ==2 & d_949302066 == 231311385 & d_976570371 == 231311385 ~ "module 1,3" ,
                                                 modules ==2 & d_949302066 == 231311385 & d_663265240 == 231311385 ~ "module 1,4" ,
                                                 modules ==2 & d_536735468 == 231311385 & d_976570371 == 231311385 ~ "module 2,3" ,
                                                 modules ==2 & d_536735468 == 231311385 & d_663265240 == 231311385 ~ "module 2,4" ,
                                                 modules ==2 & d_976570371 == 231311385 & d_663265240 == 231311385 ~ "module 3,4" ,
                                                 modules ==3 & d_949302066 == 231311385 & d_536735468 == 231311385 & d_976570371 == 231311385 ~ "module 1,2,3" ,
                                                 modules ==3 & d_949302066 == 231311385 & d_976570371 == 231311385 & d_663265240 == 231311385~ "module 1,3,4" ,
                                                 modules ==3 & d_949302066 == 231311385 & d_536735468 == 231311385 & d_663265240 == 231311385 ~ "module 1,2,4",
                                                 modules ==3 & d_536735468 == 231311385 & d_976570371 == 231311385 & d_663265240 == 231311385 ~ "module 2,3,4" ,
                                                 modules ==0 ~ "None",
                                                 modules ==4 ~ "All"))
table(modules1$process)
tab1(modules1$process, decimal=2,sort.group = "decreasing", cum.percent = TRUE)$output.table

##MAKE INTO A PRESENTABLE TABLE:

#### ran this part before but now may not need to?
# modules1 <-as_gt(modules1) ##THIS WAS WORKING BEFORE!! WHY NOT ANYMORE?!
# head(modules1)

ccc1= modules1 %>%  mutate(freq=if(!is.na(modules1$Connect_ID)){1})
head(ccc1)
dim(ccc1)[[1]]

ccc1$percentage= (ccc1$freq/dim(ccc1)[[1]])*100 
head(ccc1)

dt <- ccc1[ , c(9,10, 11)] #want only frequency, process and percentage of participants 
head(dt)



dt_summary <- dt %>%  group_by(process) %>% summarize_at(c("freq", "percentage"), sum, na.rm = TRUE) #%>% 
#gather("process", -freq) #not allowing decreasing frequency
gt_print <- gt(dt_summary)
gt_print



```

```{r, echo=FALSE}
#Make the automated table

dt_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = html("Verified Participants Survey Completion")) %>% 
  tab_footnote(
    footnote = "This includes impossible scenarios: Modules 2, 3, and/or 4 being completed without Module 1 first completed. Only scenarios that have occured will show on this table.") %>%
  cols_label(process = md("**Modules Completed**"), freq = md("**Number of participants (n)**"), percentage = md("**Percentage of Participants**")) %>% 
  summary_rows(
    columns = c(freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = process,
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "gray90"),
      locations = cells_body(
      rows = c(1,3,5,7,9)
    )
  ) %>%  opt_row_striping()
```

# 2.	Completion of baseline tasks with percentile of not started, started, submitted of each module (active, passive, and total) for verified participants. Note, each module will be stratified into one table before all modules were available in prod, and one table after all modules were available in prod.  

# 
## Module 1

### Before all moules available 

```{r, include=FALSE}
############### MODULE 1 ########################################
# 2.	Completion of baseline tasks with number and % not started, started, submitted of each module (active_c, passive_c and total)
dim(active_c_before)
dim(passive_c_before)
dim(data_ccc_before)

  ### BEFORE ALL MODULES AV'L
sum(active_c_before$d_949302066==972455046, na.rm=TRUE)
round((sum(active_c_before$d_949302066==972455046, na.rm=TRUE)/length(active_c_before$d_949302066))*100, digits=2) #not started
sum(active_c_before$d_949302066==615768760, na.rm=TRUE)
round((sum(active_c_before$d_949302066==615768760, na.rm=TRUE)/length(active_c_before$d_949302066))*100, digits=2)#started
sum(active_c_before$d_949302066==231311385, na.rm=TRUE)
round((sum(active_c_before$d_949302066==231311385, na.rm=TRUE)/length(active_c_before$d_949302066))*100, digits=2)#submitted

sum(passive_c_before$d_949302066==972455046, na.rm=TRUE)
round((sum(passive_c_before$d_949302066==972455046, na.rm=TRUE)/length(passive_c_before$d_949302066))*100, digits=2) #not started
sum(passive_c_before$d_949302066==615768760, na.rm=TRUE)
round((sum(passive_c_before$d_949302066==615768760, na.rm=TRUE)/length(passive_c_before$d_949302066))*100, digits=2)#started
sum(passive_c_before$d_949302066==231311385, na.rm=TRUE)
round((sum(passive_c_before$d_949302066==231311385, na.rm=TRUE)/length(passive_c_before$d_949302066))*100, digits=2)#submitted

sum(data_ccc_before$d_949302066==972455046, na.rm=TRUE)
round((sum(data_ccc_before$d_949302066==972455046, na.rm=TRUE)/length(data_ccc_before$d_949302066))*100, digits=2) #not started
sum(data_ccc_before$d_949302066==615768760, na.rm=TRUE)
round((sum(data_ccc_before$d_949302066==615768760, na.rm=TRUE)/length(data_ccc_before$d_949302066))*100, digits=2) #started
sum(data_ccc_before$d_949302066==231311385, na.rm=TRUE)
round((sum(data_ccc_before$d_949302066==231311385, na.rm=TRUE)/length(data_ccc_before$d_949302066))*100, digits=2) #submitted


#Make the automated table
data_tib2b= as_tibble(data_ccc_before) 
head(data_tib2b)

data_tib2a= as_tibble(data_ccc_after) 
head(data_tib2a)

 ##BERFORE
dt2b <- data_tib2b[ , c(1,2,6 )] #want only frequency, process and percentage of participants 
head(dt2b)

dt2b= dt2b %>%  mutate(freq=if(!is.na(dt2b$Connect_ID)){1})
head(dt2b)
dim(dt2b)[[1]]

ccc2b= dt2b %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2b)

ccc2b= ccc2b %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2b)

ccc2b$percentage= (ccc2b$freq/dim(ccc2b)[[1]])*100 
head(ccc2b) 

ccc2b$percentage.Active= (ccc2b$freq.Active/dim(ccc2b)[[1]])*100 
head(ccc2b)

ccc2b$percentage.Passive= (ccc2b$freq.Passive/dim(ccc2b)[[1]])*100 
head(ccc2b)


ccc2b <- ccc2b %>% mutate(status=case_when(d_949302066 == 972455046  ~ "Module 1 Not Started",
                                               d_949302066 == 615768760  ~ "Module 1 Started",
                                               d_949302066 == 231311385  ~ "Module 1 Completed"))
head(ccc2b)



ccc2b <- ccc2b[, c(4:10)] #
head(ccc2b)

ccc2b_summary <- ccc2b %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2b_summary)                                                                              
gt_print2A
```

```{r, echo=FALSE, warning=FALSE}


ccc2b_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 1 Completion Status of Verified Participants (Before)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
               tab_footnote(
                 footnote = "Verification completed prior to July 5,2022 when all modules became available in prod") %>%
               tab_spanner(
                 label="Active",
                 columns=vars(freq.Active,percentage.Active)
               ) %>% 
               tab_spanner(
                 label="Passive",
                 columns=vars(freq.Passive,percentage.Passive)
               ) %>% 
               tab_spanner(
                 label="Total",
                 columns=vars(freq, percentage)
               ) %>% 
               # tab_style(
               #   cell_text(
               #   align="center"),
               #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
               # ) %>% 
               summary_rows(
                 #    groups= T, 
                 columns =  c(freq.Active,freq.Passive, freq, percentage),
                 fns= list(
                   Sum= ~sum(.)
                 ), decimals=0) %>% 
               summary_rows(
                 #    groups= T, 
                 columns = c(percentage.Active, percentage.Passive),
                 fns= list(
                   Sum= ~sum(.))) %>%
               tab_options(
                 heading.title.font.size = 25,
                 heading.padding = 10,
                 row_group.font.weight = "bolder",
                 summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
                 row_group.background.color =    "#99CCFF",
                 table.width=pct(50)
               ) %>%
               tab_style(
                 style = list(
                   cell_text(weight = "bold")
                 ),
                 locations = cells_body(
                   columns = status,
                 )
               )  %>% 
               tab_style(
                 style= list(
                   cell_text(
                     align="center"
                   )
                 ),
                 locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
               ) %>%  opt_row_striping()

#kable(Num2_M1, format="latex", booktabs=T) %>%  kable_styling(latex_option="scale down")


```
# 
### On or after all modules available 

```{r, include=FALSE}
  ### AFTER ALL MODULES AV'L 
dim(active_c_after)
dim(passive_c_after)
dim(data_ccc_after)

sum(active_c_after$d_949302066==972455046, na.rm=TRUE)
round((sum(active_c_after$d_949302066==972455046, na.rm=TRUE)/length(active_c_after$d_949302066))*100, digits=2) #not started
sum(active_c_after$d_949302066==615768760, na.rm=TRUE)
round((sum(active_c_after$d_949302066==615768760, na.rm=TRUE)/length(active_c_after$d_949302066))*100, digits=2)#started
sum(active_c_after$d_949302066==231311385, na.rm=TRUE)
round((sum(active_c_after$d_949302066==231311385, na.rm=TRUE)/length(active_c_after$d_949302066))*100, digits=2)#submitted

sum(passive_c_after$d_949302066==972455046, na.rm=TRUE)
round((sum(passive_c_after$d_949302066==972455046, na.rm=TRUE)/length(passive_c_after$d_949302066))*100, digits=2) #not started
sum(passive_c_after$d_949302066==615768760, na.rm=TRUE)
round((sum(passive_c_after$d_949302066==615768760, na.rm=TRUE)/length(passive_c_after$d_949302066))*100, digits=2)#started
sum(passive_c_after$d_949302066==231311385, na.rm=TRUE)
round((sum(passive_c_after$d_949302066==231311385, na.rm=TRUE)/length(passive_c_after$d_949302066))*100, digits=2)#submitted

sum(data_ccc_after$d_949302066==972455046, na.rm=TRUE)
round((sum(data_ccc_after$d_949302066==972455046, na.rm=TRUE)/length(data_ccc_after$d_949302066))*100, digits=2) #not started
sum(data_ccc_after$d_949302066==615768760, na.rm=TRUE)
round((sum(data_ccc_after$d_949302066==615768760, na.rm=TRUE)/length(data_ccc_after$d_949302066))*100, digits=2) #started
sum(data_ccc_after$d_949302066==231311385, na.rm=TRUE)
round((sum(data_ccc_after$d_949302066==231311385, na.rm=TRUE)/length(data_ccc_after$d_949302066))*100, digits=2) #submitted


#Make the automated table

dt2a <- data_tib2a[ , c(1,2,6 )] #want only frequency, process and percentage of participants 
head(dt2a)

dt2a= dt2a %>%  mutate(freq=if(!is.na(dt2a$Connect_ID)){1})
head(dt2a)
dim(dt2a)[[1]]

ccc2a= dt2a %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2a)

ccc2a= ccc2a %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2a)

ccc2a$percentage= (ccc2a$freq/dim(ccc2a)[[1]])*100 
head(ccc2a) 

ccc2a$percentage.Active= (ccc2a$freq.Active/dim(ccc2a)[[1]])*100 
head(ccc2a)

ccc2a$percentage.Passive= (ccc2a$freq.Passive/dim(ccc2a)[[1]])*100 
head(ccc2a)
  
  
ccc2a <- ccc2a %>% mutate(status=case_when(d_949302066 == 972455046  ~ "Module 1 Not Started",
                                             d_949302066 == 615768760  ~ "Module 1 Started",
                                             d_949302066 == 231311385  ~ "Module 1 Completed"))
head(ccc2a)



ccc2a <- ccc2a[, c(4:10)] #
head(ccc2a)

ccc2a_summary <- ccc2a %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2a_summary)                                                                              
gt_print2A
```

```{r, echo=FALSE, warning=FALSE}



ccc2a_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 1 Completion Status of Verified Participants (On or After)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all modules became available in prod") %>%
  tab_spanner(
    label="Active",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
  summary_rows(
    #    groups= T, 
    columns =  c(freq.Active,freq.Passive, freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% 
  summary_rows(
    #    groups= T, 
    columns = c(percentage.Active, percentage.Passive),
    fns= list(
      Sum= ~sum(.))) %>%
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```


# 
## Module 2

### Before all modules available 
```{r, include=FALSE}
### BEFORE ALL MODULES AV'L
sum(active_c_before$d_536735468==972455046, na.rm=TRUE)
round((sum(active_c_before$d_536735468==972455046, na.rm=TRUE)/length(active_c_before$d_536735468))*100, digits=2) #not started
sum(active_c_before$d_536735468==615768760, na.rm=TRUE)
round((sum(active_c_before$d_536735468==615768760, na.rm=TRUE)/length(active_c_before$d_536735468))*100, digits=2)#started
sum(active_c_before$d_536735468==231311385, na.rm=TRUE)
round((sum(active_c_before$d_536735468==231311385, na.rm=TRUE)/length(active_c_before$d_536735468))*100, digits=2)#submitted

sum(passive_c_before$d_536735468==972455046, na.rm=TRUE)
round((sum(passive_c_before$d_536735468==972455046, na.rm=TRUE)/length(passive_c_before$d_536735468))*100, digits=2) #not started
sum(passive_c_before$d_536735468==615768760, na.rm=TRUE)
round((sum(passive_c_before$d_536735468==615768760, na.rm=TRUE)/length(passive_c_before$d_536735468))*100, digits=2)#started
sum(passive_c_before$d_536735468==231311385, na.rm=TRUE)
round((sum(passive_c_before$d_536735468==231311385, na.rm=TRUE)/length(passive_c_before$d_536735468))*100, digits=2)#submitted

sum(data_ccc_before$d_536735468==972455046, na.rm=TRUE)
round((sum(data_ccc_before$d_536735468==972455046, na.rm=TRUE)/length(data_ccc_before$d_536735468))*100, digits=2) #not started
sum(data_ccc_before$d_536735468==615768760, na.rm=TRUE)
round((sum(data_ccc_before$d_536735468==615768760, na.rm=TRUE)/length(data_ccc_before$d_536735468))*100, digits=2) #started
sum(data_ccc_before$d_536735468==231311385, na.rm=TRUE)
round((sum(data_ccc_before$d_536735468==231311385, na.rm=TRUE)/length(data_ccc_before$d_536735468))*100, digits=2) #submitted


dt2b <- data_tib2b[ , c(1,2,8 )] #want only frequency, process and percentage of participants 
head(dt2b)
table(dt2b$d_536735468)

dt2b= dt2b %>%  mutate(freq=if(!is.na(dt2b$Connect_ID)){1})
head(dt2b)
dim(dt2b)[[1]]

ccc2b= dt2b %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2b)

ccc2b= ccc2b %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2b)

ccc2b$percentage= (ccc2b$freq/dim(ccc2b)[[1]])*100 
head(ccc2b) 

ccc2b$percentage.Active= (ccc2b$freq.Active/dim(ccc2b)[[1]])*100 
head(ccc2b)

ccc2b$percentage.Passive= (ccc2b$freq.Passive/dim(ccc2b)[[1]])*100 
head(ccc2b)


ccc2b <- ccc2b %>% mutate(status=case_when(d_536735468 == 972455046  ~ "Module 2 Not Started",
                                               d_536735468 == 615768760  ~ "Module 2 Started",
                                               d_536735468 == 231311385  ~ "Module 2 Completed"))
head(ccc2b)



ccc2b <- ccc2b[, c(4:10)] #
head(ccc2b)

ccc2b_summary <- ccc2b %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2b_summary)                                                                              
gt_print2A
```

```{r, echo=FALSE, warning=FALSE}
#Make the automated table




ccc2b_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 2 Completion Status of Verified Participants (Before)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
               tab_footnote(
                 footnote = "Verification completed prior to July 5,2022 when all modules became available in prod") %>%
               tab_spanner(
                 label="Active",
                 columns=vars(freq.Active,percentage.Active)
               ) %>% 
               tab_spanner(
                 label="Passive",
                 columns=vars(freq.Passive,percentage.Passive)
               ) %>% 
               tab_spanner(
                 label="Total",
                 columns=vars(freq, percentage)
               ) %>% 
               # tab_style(
               #   cell_text(
               #   align="center"),
               #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
               # ) %>% 
               summary_rows(
                 #    groups= T, 
                 columns =  c(freq.Active,freq.Passive, freq, percentage),
                 fns= list(
                   Sum= ~sum(.)
                 ), decimals=0) %>% 
               summary_rows(
                 #    groups= T, 
                 columns = c(percentage.Active, percentage.Passive),
                 fns= list(
                   Sum= ~sum(.))) %>%
               tab_options(
                 heading.title.font.size = 25,
                 heading.padding = 10,
                 row_group.font.weight = "bolder",
                 summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
                 row_group.background.color =    "#99CCFF"
               ) %>%
               tab_style(
                 style = list(
                   cell_text(weight = "bold")
                 ),
                 locations = cells_body(
                   columns = status,
                 )
               )  %>% 
               tab_style(
                 style= list(
                   cell_text(
                     align="center"
                   )
                 ),
                 locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
               ) %>%  opt_row_striping()

```

### On or after all modules available 
```{r, include=FALSE}
### AFTER ALL MODULES AV'L
dim(active_c_after)
dim(passive_c_after)
dim(data_ccc_after)

sum(active_c_after$d_536735468==972455046, na.rm=TRUE)
round((sum(active_c_after$d_536735468==972455046, na.rm=TRUE)/length(active_c_after$d_536735468))*100, digits=2) #not started
sum(active_c_after$d_536735468==615768760, na.rm=TRUE)
round((sum(active_c_after$d_536735468==615768760, na.rm=TRUE)/length(active_c_after$d_536735468))*100, digits=2)#started
sum(active_c_after$d_536735468==231311385, na.rm=TRUE)
round((sum(active_c_after$d_536735468==231311385, na.rm=TRUE)/length(active_c_after$d_536735468))*100, digits=2)#submitted

sum(passive_c_after$d_536735468==972455046, na.rm=TRUE)
round((sum(passive_c_after$d_536735468==972455046, na.rm=TRUE)/length(passive_c_after$d_536735468))*100, digits=2) #not started
sum(passive_c_after$d_536735468==615768760, na.rm=TRUE)
round((sum(passive_c_after$d_536735468==615768760, na.rm=TRUE)/length(passive_c_after$d_536735468))*100, digits=2)#started
sum(passive_c_after$d_536735468==231311385, na.rm=TRUE)
round((sum(passive_c_after$d_536735468==231311385, na.rm=TRUE)/length(passive_c_after$d_536735468))*100, digits=2)#submitted

sum(data_ccc_after$d_536735468==972455046, na.rm=TRUE)
round((sum(data_ccc_after$d_536735468==972455046, na.rm=TRUE)/length(data_ccc_after$d_536735468))*100, digits=2) #not started
sum(data_ccc_after$d_536735468==615768760, na.rm=TRUE)
round((sum(data_ccc_after$d_536735468==615768760, na.rm=TRUE)/length(data_ccc_after$d_536735468))*100, digits=2) #started
sum(data_ccc_after$d_536735468==231311385, na.rm=TRUE)
round((sum(data_ccc_after$d_536735468==231311385, na.rm=TRUE)/length(data_ccc_after$d_536735468))*100, digits=2) #submitted


#Make the automated table
dt2a <- data_tib2a[ , c(1,2,8 )] #want only frequency, process and percentage of participants 
head(dt2a)

dt2a= dt2a %>%  mutate(freq=if(!is.na(dt2a$Connect_ID)){1})
head(dt2a)
dim(dt2a)[[1]]

ccc2a= dt2a %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2a)

ccc2a= ccc2a %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2a)

ccc2a$percentage= (ccc2a$freq/dim(ccc2a)[[1]])*100 
head(ccc2a) 

ccc2a$percentage.Active= (ccc2a$freq.Active/dim(ccc2a)[[1]])*100 
head(ccc2a)

ccc2a$percentage.Passive= (ccc2a$freq.Passive/dim(ccc2a)[[1]])*100 
head(ccc2a)
  
  
ccc2a <- ccc2a %>% mutate(status=case_when(d_536735468 == 972455046  ~ "Module 2 Not Started",
                                             d_536735468 == 615768760  ~ "Module 2 Started",
                                             d_536735468 == 231311385  ~ "Module 2 Completed"))
head(ccc2a)



ccc2a <- ccc2a[, c(4:10)] #
head(ccc2a)

ccc2a_summary <- ccc2a %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2a_summary)                                                                              
gt_print2A

```

```{r, echo=FALSE, warning=FALSE}


ccc2a_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 2 Completion Status of Verified Participants (On or After)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all modules became available in prod") %>%
  tab_spanner(
    label="Active",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
  summary_rows(
    #    groups= T, 
    columns =  c(freq.Active,freq.Passive, freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% 
  summary_rows(
    #    groups= T, 
    columns = c(percentage.Active, percentage.Passive),
    fns= list(
      Sum= ~sum(.))) %>%
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```
# 
## Module 3
### Before all modules available 
```{r, include=FALSE}
### BEFORE ALL MODULES AV'L
sum(active_c_before$d_976570371==972455046, na.rm=TRUE)
round((sum(active_c_before$d_976570371==972455046, na.rm=TRUE)/length(active_c_before$d_976570371))*100, digits=2) #not started
sum(active_c_before$d_976570371==615768760, na.rm=TRUE)
round((sum(active_c_before$d_976570371==615768760, na.rm=TRUE)/length(active_c_before$d_976570371))*100, digits=2)#started
sum(active_c_before$d_976570371==231311385, na.rm=TRUE)
round((sum(active_c_before$d_976570371==231311385, na.rm=TRUE)/length(active_c_before$d_976570371))*100, digits=2)#submitted

sum(passive_c_before$d_976570371==972455046, na.rm=TRUE)
round((sum(passive_c_before$d_976570371==972455046, na.rm=TRUE)/length(passive_c_before$d_976570371))*100, digits=2) #not started
sum(passive_c_before$d_976570371==615768760, na.rm=TRUE)
round((sum(passive_c_before$d_976570371==615768760, na.rm=TRUE)/length(passive_c_before$d_976570371))*100, digits=2)#started
sum(passive_c_before$d_976570371==231311385, na.rm=TRUE)
round((sum(passive_c_before$d_976570371==231311385, na.rm=TRUE)/length(passive_c_before$d_976570371))*100, digits=2)#submitted

sum(data_ccc_before$d_976570371==972455046, na.rm=TRUE)
round((sum(data_ccc_before$d_976570371==972455046, na.rm=TRUE)/length(data_ccc_before$d_976570371))*100, digits=2) #not started
sum(data_ccc_before$d_976570371==615768760, na.rm=TRUE)
round((sum(data_ccc_before$d_976570371==615768760, na.rm=TRUE)/length(data_ccc_before$d_976570371))*100, digits=2) #started
sum(data_ccc_before$d_976570371==231311385, na.rm=TRUE)
round((sum(data_ccc_before$d_976570371==231311385, na.rm=TRUE)/length(data_ccc_before$d_976570371))*100, digits=2) #submitted


dt2b <- data_tib2b[ , c(1,2,9 )] #want only frequency, process and percentage of participants 
head(dt2b)
table(dt2b$d_536735468)

dt2b= dt2b %>%  mutate(freq=if(!is.na(dt2b$Connect_ID)){1})
head(dt2b)
dim(dt2b)[[1]]

ccc2b= dt2b %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2b)

ccc2b= ccc2b %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2b)

ccc2b$percentage= (ccc2b$freq/dim(ccc2b)[[1]])*100 
head(ccc2b) 

ccc2b$percentage.Active= (ccc2b$freq.Active/dim(ccc2b)[[1]])*100 
head(ccc2b)

ccc2b$percentage.Passive= (ccc2b$freq.Passive/dim(ccc2b)[[1]])*100 
head(ccc2b)


ccc2b <- ccc2b %>% mutate(status=case_when(d_976570371 == 972455046  ~ "Module 3 Not Started",
                                               d_976570371 == 615768760  ~ "Module 3 Started",
                                               d_976570371 == 231311385  ~ "Module 3 Completed"))
head(ccc2b)



ccc2b <- ccc2b[, c(4:10)] #
head(ccc2b)

ccc2b_summary <- ccc2b %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2b_summary)                                                                              
gt_print2A
```

```{r, echo=FALSE, warning=FALSE}
#Make the automated table



ccc2b_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 3 Completion Status of Verified Participants (Before)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
               tab_footnote(
                 footnote = "Verification completed prior to July 5,2022 when all modules became available in prod") %>%
               tab_spanner(
                 label="Active",
                 columns=vars(freq.Active,percentage.Active)
               ) %>% 
               tab_spanner(
                 label="Passive",
                 columns=vars(freq.Passive,percentage.Passive)
               ) %>% 
               tab_spanner(
                 label="Total",
                 columns=vars(freq, percentage)
               ) %>% 
               # tab_style(
               #   cell_text(
               #   align="center"),
               #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
               # ) %>% 
               summary_rows(
                 #    groups= T, 
                 columns =  c(freq.Active,freq.Passive, freq, percentage),
                 fns= list(
                   Sum= ~sum(.)
                 ), decimals=0) %>% 
               summary_rows(
                 #    groups= T, 
                 columns = c(percentage.Active, percentage.Passive),
                 fns= list(
                   Sum= ~sum(.))) %>%
               tab_options(
                 heading.title.font.size = 25,
                 heading.padding = 10,
                 row_group.font.weight = "bolder",
                 summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
                 row_group.background.color =    "#99CCFF"
               ) %>%
               tab_style(
                 style = list(
                   cell_text(weight = "bold")
                 ),
                 locations = cells_body(
                   columns = status,
                 )
               )  %>% 
               tab_style(
                 style= list(
                   cell_text(
                     align="center"
                   )
                 ),
                 locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
               ) %>%  opt_row_striping()

```

### On or after all modules available 
```{r, include=FALSE}

### AFTER ALL MODULES AV'L 
sum(active_c_after$d_976570371==972455046, na.rm=TRUE)
round((sum(active_c_after$d_976570371==972455046, na.rm=TRUE)/length(active_c_after$d_976570371))*100, digits=2) #not started
sum(active_c_after$d_976570371==615768760, na.rm=TRUE)
round((sum(active_c_after$d_976570371==615768760, na.rm=TRUE)/length(active_c_after$d_976570371))*100, digits=2)#started
sum(active_c_after$d_976570371==231311385, na.rm=TRUE)
round((sum(active_c_after$d_976570371==231311385, na.rm=TRUE)/length(active_c_after$d_976570371))*100, digits=2)#submitted

sum(passive_c_after$d_976570371==972455046, na.rm=TRUE)
round((sum(passive_c_after$d_976570371==972455046, na.rm=TRUE)/length(passive_c_after$d_976570371))*100, digits=2) #not started
sum(passive_c_after$d_976570371==615768760, na.rm=TRUE)
round((sum(passive_c_after$d_976570371==615768760, na.rm=TRUE)/length(passive_c_after$d_976570371))*100, digits=2)#started
sum(passive_c_after$d_976570371==231311385, na.rm=TRUE)
round((sum(passive_c_after$d_976570371==231311385, na.rm=TRUE)/length(passive_c_after$d_976570371))*100, digits=2)#submitted

sum(data_ccc_after$d_976570371==972455046, na.rm=TRUE)
round((sum(data_ccc_after$d_976570371==972455046, na.rm=TRUE)/length(data_ccc_after$d_976570371))*100, digits=2) #not started
sum(data_ccc_after$d_976570371==615768760, na.rm=TRUE)
round((sum(data_ccc_after$d_976570371==615768760, na.rm=TRUE)/length(data_ccc_after$d_976570371))*100, digits=2) #started
sum(data_ccc_after$d_976570371==231311385, na.rm=TRUE)
round((sum(data_ccc_after$d_976570371==231311385, na.rm=TRUE)/length(data_ccc_after$d_976570371))*100, digits=2) #submitted


#Make the automated table
dt2a <- data_tib2a[ , c(1,2,9 )] #want only frequency, process and percentage of participants 
head(dt2a)

dt2a= dt2a %>%  mutate(freq=if(!is.na(dt2a$Connect_ID)){1})
head(dt2a)
dim(dt2a)[[1]]

ccc2a= dt2a %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2a)

ccc2a= ccc2a %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2a)

ccc2a$percentage= (ccc2a$freq/dim(ccc2a)[[1]])*100 
head(ccc2a) 

ccc2a$percentage.Active= (ccc2a$freq.Active/dim(ccc2a)[[1]])*100 
head(ccc2a)

ccc2a$percentage.Passive= (ccc2a$freq.Passive/dim(ccc2a)[[1]])*100 
head(ccc2a)
  
  
ccc2a <- ccc2a %>% mutate(status=case_when(d_976570371 == 972455046  ~ "Module 3 Not Started",
                                             d_976570371 == 615768760  ~ "Module 3 Started",
                                             d_976570371 == 231311385  ~ "Module 3 Completed"))
head(ccc2a)



ccc2a <- ccc2a[, c(4:10)] #
head(ccc2a)

ccc2a_summary <- ccc2a %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2a_summary)                                                                              
gt_print2A


```

```{r, echo=FALSE, warning=FALSE}



ccc2a_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 3 Completion Status of Verified Participants (On or After)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all modules became available in prod") %>%
  tab_spanner(
    label="Active",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
  summary_rows(
    #    groups= T, 
    columns =  c(freq.Active,freq.Passive, freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% 
  summary_rows(
    #    groups= T, 
    columns = c(percentage.Active, percentage.Passive),
    fns= list(
      Sum= ~sum(.))) %>%
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```
# 
## Module 4
### Before all modules available
```{r, include=FALSE}
# 2.	Completion of baseline tasks with number and % not started, started, submitted of each module (active_c, passive_c and total)  

###BEFORE ALL MODULES AV'L
sum(active_c_before$d_663265240==972455046, na.rm=TRUE)
round((sum(active_c_before$d_663265240==972455046, na.rm=TRUE)/length(active_c_before$d_663265240))*100, digits=2) #not started
sum(active_c_before$d_663265240==615768760, na.rm=TRUE)
round((sum(active_c_before$d_663265240==615768760, na.rm=TRUE)/length(active_c_before$d_663265240))*100, digits=2)#started
sum(active_c_before$d_663265240==231311385, na.rm=TRUE)
round((sum(active_c_before$d_663265240==231311385, na.rm=TRUE)/length(active_c_before$d_663265240))*100, digits=2)#submitted

sum(passive_c_before$d_663265240==972455046, na.rm=TRUE)
round((sum(passive_c_before$d_663265240==972455046, na.rm=TRUE)/length(passive_c_before$d_663265240))*100, digits=2) #not started
sum(passive_c_before$d_663265240==615768760, na.rm=TRUE)
round((sum(passive_c_before$d_663265240==615768760, na.rm=TRUE)/length(passive_c_before$d_663265240))*100, digits=2)#started
sum(passive_c_before$d_663265240==231311385, na.rm=TRUE)
round((sum(passive_c_before$d_663265240==231311385, na.rm=TRUE)/length(passive_c_before$d_663265240))*100, digits=2)#submitted

sum(data_ccc_before$d_663265240==972455046, na.rm=TRUE)
round((sum(data_ccc_before$d_663265240==972455046, na.rm=TRUE)/length(data_ccc_before$d_663265240))*100, digits=2) #not started
sum(data_ccc_before$d_663265240==615768760, na.rm=TRUE)
round((sum(data_ccc_before$d_663265240==615768760, na.rm=TRUE)/length(data_ccc_before$d_663265240))*100, digits=2) #started
sum(data_ccc_before$d_663265240==231311385, na.rm=TRUE)
round((sum(data_ccc_before$d_663265240==231311385, na.rm=TRUE)/length(data_ccc_before$d_663265240))*100, digits=2) #submitted


#Make automated table
dt2b <- data_tib2b[ , c(1,2,10 )] #want only frequency, process and percentage of participants 
head(dt2b)
table(dt2b$d_536735468)

dt2b= dt2b %>%  mutate(freq=if(!is.na(dt2b$Connect_ID)){1})
head(dt2b)
dim(dt2b)[[1]]

ccc2b= dt2b %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2b)

ccc2b= ccc2b %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2b)

ccc2b$percentage= (ccc2b$freq/dim(ccc2b)[[1]])*100 
head(ccc2b) 

ccc2b$percentage.Active= (ccc2b$freq.Active/dim(ccc2b)[[1]])*100 
head(ccc2b)

ccc2b$percentage.Passive= (ccc2b$freq.Passive/dim(ccc2b)[[1]])*100 
head(ccc2b)


ccc2b <- ccc2b %>% mutate(status=case_when(d_663265240 == 972455046  ~ "Module 4 Not Started",
                                               d_663265240 == 615768760  ~ "Module 4 Started",
                                               d_663265240 == 231311385  ~ "Module 4 Completed"))
head(ccc2b)



ccc2b <- ccc2b[, c(4:10)] #
head(ccc2b)

ccc2b_summary <- ccc2b %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2b_summary)                                                                              
gt_print2A

```

```{r, echo=FALSE, warning=FALSE}



ccc2b_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 4 Completion Status of Verified Participants (Before)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
               tab_footnote(
                 footnote = "Verification completed prior to July 5,2022 when all modules became available in prod") %>%
               tab_spanner(
                 label="Active",
                 columns=vars(freq.Active,percentage.Active)
               ) %>% 
               tab_spanner(
                 label="Passive",
                 columns=vars(freq.Passive,percentage.Passive)
               ) %>% 
               tab_spanner(
                 label="Total",
                 columns=vars(freq, percentage)
               ) %>% 
               # tab_style(
               #   cell_text(
               #   align="center"),
               #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
               # ) %>% 
               summary_rows(
                 #    groups= T, 
                 columns =  c(freq.Active,freq.Passive, freq, percentage),
                 fns= list(
                   Sum= ~sum(.)
                 ), decimals=0) %>% 
               summary_rows(
                 #    groups= T, 
                 columns = c(percentage.Active, percentage.Passive),
                 fns= list(
                   Sum= ~sum(.))) %>%
               tab_options(
                 heading.title.font.size = 25,
                 heading.padding = 10,
                 row_group.font.weight = "bolder",
                 summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
                 row_group.background.color =    "#99CCFF"
               ) %>%
               tab_style(
                 style = list(
                   cell_text(weight = "bold")
                 ),
                 locations = cells_body(
                   columns = status,
                 )
               )  %>% 
               tab_style(
                 style= list(
                   cell_text(
                     align="center"
                   )
                 ),
                 locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
               ) %>%  opt_row_striping()


```

### On or after all modules available
```{r, include=FALSE}
### AFTER ALL MODULES AV'L 
sum(active_c_after$d_663265240==972455046, na.rm=TRUE)
round((sum(active_c_after$d_663265240==972455046, na.rm=TRUE)/length(active_c_after$d_663265240))*100, digits=2) #not started
sum(active_c_after$d_663265240==615768760, na.rm=TRUE)
round((sum(active_c_after$d_663265240==615768760, na.rm=TRUE)/length(active_c_after$d_663265240))*100, digits=2)#started
sum(active_c_after$d_663265240==231311385, na.rm=TRUE)
round((sum(active_c_after$d_663265240==231311385, na.rm=TRUE)/length(active_c_after$d_663265240))*100, digits=2)#submitted

sum(passive_c_after$d_663265240==972455046, na.rm=TRUE)
round((sum(passive_c_after$d_663265240==972455046, na.rm=TRUE)/length(passive_c_after$d_663265240))*100, digits=2) #not started
sum(passive_c_after$d_663265240==615768760, na.rm=TRUE)
round((sum(passive_c_after$d_663265240==615768760, na.rm=TRUE)/length(passive_c_after$d_663265240))*100, digits=2)#started
sum(passive_c_after$d_663265240==231311385, na.rm=TRUE)
round((sum(passive_c_after$d_663265240==231311385, na.rm=TRUE)/length(passive_c_after$d_663265240))*100, digits=2)#submitted

sum(data_ccc_after$d_663265240==972455046, na.rm=TRUE)
round((sum(data_ccc_after$d_663265240==972455046, na.rm=TRUE)/length(data_ccc_after$d_663265240))*100, digits=2) #not started
sum(data_ccc_after$d_663265240==615768760, na.rm=TRUE)
round((sum(data_ccc_after$d_663265240==615768760, na.rm=TRUE)/length(data_ccc_after$d_663265240))*100, digits=2) #started
sum(data_ccc_after$d_663265240==231311385, na.rm=TRUE)
round((sum(data_ccc_after$d_663265240==231311385, na.rm=TRUE)/length(data_ccc_after$d_663265240))*100, digits=2) #submitted

#Make automated table
dt2a <- data_tib2a[ , c(1,2,10 )] #want only frequency, process and percentage of participants 
head(dt2a)

dt2a= dt2a %>%  mutate(freq=if(!is.na(dt2a$Connect_ID)){1})
head(dt2a)
dim(dt2a)[[1]]

ccc2a= dt2a %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2a)

ccc2a= ccc2a %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2a)

ccc2a$percentage= (ccc2a$freq/dim(ccc2a)[[1]])*100 
head(ccc2a) 

ccc2a$percentage.Active= (ccc2a$freq.Active/dim(ccc2a)[[1]])*100 
head(ccc2a)

ccc2a$percentage.Passive= (ccc2a$freq.Passive/dim(ccc2a)[[1]])*100 
head(ccc2a)
  
  
ccc2a <- ccc2a %>% mutate(status=case_when(d_663265240 == 972455046  ~ "Module 4 Not Started",
                                             d_663265240 == 615768760  ~ "Module 4 Started",
                                             d_663265240 == 231311385  ~ "Module 4 Completed"))
head(ccc2a)



ccc2a <- ccc2a[, c(4:10)] #
head(ccc2a)

ccc2a_summary <- ccc2a %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2a_summary)                                                                              
gt_print2A


```

```{r, echo=FALSE, warning=FALSE}



ccc2a_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 4 Completion Status of Verified Participants (On or After)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all modules became available in prod") %>%
  tab_spanner(
    label="Active",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
  summary_rows(
    #    groups= T, 
    columns =  c(freq.Active,freq.Passive, freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% 
  summary_rows(
    #    groups= T, 
    columns = c(percentage.Active, percentage.Passive),
    fns= list(
      Sum= ~sum(.))) %>%
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()


```

# 3.	Time in minutes from verification to completion of each module- 25, 50, 75 percentiles (active, passive, and total). 

# 
## Module 1 
### Before all modules available 
```{r, include=FALSE}
# 3.	Time from verification to completion of each module- Hours 25, 50, 75 percentile (active_c, passive_c and total)  
#d_914594314 verified
#d_517311251 Mod1 completion time stamp

time.var1 <- c("d_914594314","d_517311251")

###BEFORE
#All verified participant totals that have completed mod1
act_before= active_c_before %>% filter(d_949302066==231311385)
dim(act_before)
pas_before= passive_c_before %>% filter(d_949302066==231311385)
dim(pas_before)
mer_before= data_ccc_before %>% filter(d_949302066==231311385)
dim(mer_before)


#Active
act_before_time<- act_before[complete.cases(act_before[ , time.var1]), ]


tmp1A <- act_before_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1A$d_914594314 <- as.POSIXct(ymd_hms(tmp1A$d_914594314))
tmp1A$d_517311251 <- as.POSIXct(ymd_hms(tmp1A$d_517311251))


tmp1A$Mod1completionA <- difftime(tmp1A$d_517311251, tmp1A$d_914594314, units="mins")
summary(as.numeric(tmp1A$Mod1completionA)) #normal for some of these to be negative, active parts. can get verified later on


#Passive
pas_before_time<- pas_before[complete.cases(pas_before[ , time.var1]), ]


tmp1P <- pas_before_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1P$d_914594314 <- as.POSIXct(ymd_hms(tmp1P$d_914594314))
tmp1P$d_517311251 <- as.POSIXct(ymd_hms(tmp1P$d_517311251))


tmp1P$Mod1completionP <- difftime(tmp1P$d_517311251, tmp1P$d_914594314, units="mins")
summary(as.numeric(tmp1P$Mod1completionP)) #good that these are all positive, passives NEED to be verified first 


#Total
mer_before_time<- mer_before[complete.cases(mer_before[ , time.var1]), ]


tmp1T <- mer_before_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1T$d_914594314 <- as.POSIXct(ymd_hms(tmp1T$d_914594314))
tmp1T$d_517311251 <- as.POSIXct(ymd_hms(tmp1T$d_517311251))


tmp1T$Mod1completionT <- difftime(tmp1T$d_517311251, tmp1T$d_914594314, units="mins")
summary(as.numeric(tmp1T$Mod1completionT))



```

```{r, echo=FALSE}

cat("Active(n=", dim(act_before)[[1]], ")")
summary(as.numeric(tmp1A$Mod1completionA))


cat("Passive(n=", dim(pas_before)[[1]], ")")
summary(as.numeric(tmp1P$Mod1completionP))


cat("Total(n=", dim(mer_before)[[1]], ")")
summary(as.numeric(tmp1T$Mod1completionT))

```

### On or after all modules available
```{r, include=FALSE}

###AFTER
#All verified participant totals that have completed mod1
act_after= active_c_after %>% filter(d_949302066==231311385)
dim(act_after)
pas_after= passive_c_after %>% filter(d_949302066==231311385)
dim(pas_after)
mer_after= data_ccc_after %>% filter(d_949302066==231311385)
dim(mer_after)


#Active
act_after_time<- act_after[complete.cases(act_after[ , time.var1]), ]


tmp1A <- act_after_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1A$d_914594314 <- as.POSIXct(ymd_hms(tmp1A$d_914594314))
tmp1A$d_517311251 <- as.POSIXct(ymd_hms(tmp1A$d_517311251))


tmp1A$Mod1completionA <- difftime(tmp1A$d_517311251, tmp1A$d_914594314, units="mins")
summary(as.numeric(tmp1A$Mod1completionA)) #normal for some of these to be negative, active parts. can get verified later on

#Passive
pas_after_time<- pas_after[complete.cases(pas_after[ , time.var1]), ]


tmp1P <- pas_after_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1P$d_914594314 <- as.POSIXct(ymd_hms(tmp1P$d_914594314))
tmp1P$d_517311251 <- as.POSIXct(ymd_hms(tmp1P$d_517311251))


tmp1P$Mod1completionP <- difftime(tmp1P$d_517311251, tmp1P$d_914594314, units="mins")
summary(as.numeric(tmp1P$Mod1completionP)) #good that these are all positive, passsive NEED to be verified first 


#Total
mer_after_time<- mer_after[complete.cases(mer_after[ , time.var1]), ]


tmp1T <- mer_after_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1T$d_914594314 <- as.POSIXct(ymd_hms(tmp1T$d_914594314))
tmp1T$d_517311251 <- as.POSIXct(ymd_hms(tmp1T$d_517311251))


tmp1T$Mod1completionT <- difftime(tmp1T$d_517311251, tmp1T$d_914594314, units="mins")
summary(as.numeric(tmp1T$Mod1completionT))
```

```{r, echo=FALSE}

cat("Active(n=", dim(act_after)[[1]], ")")
summary(as.numeric(tmp1A$Mod1completionA))


cat("Passive(n=", dim(pas_after)[[1]], ")")
summary(as.numeric(tmp1P$Mod1completionP))


cat("Total(n=", dim(mer_after)[[1]], ")")
summary(as.numeric(tmp1T$Mod1completionT))
```
# 
## Module 2
### On or after all modules available 
```{r, include=FALSE}
# 3.	Time from verification to completion of each module (active, passive and total) 
time.var2 <- c("d_914594314","d_832139544")


##AFTER
#All verified participant totals, verified active total and verified passive total
act2 <- active_c_after %>%  filter(d_536735468==231311385)
dim(act2)
pas2 <- passive_c_after %>% filter(d_536735468==231311385)
dim(pas2)
mer2 <- data_ccc_after %>% filter(d_536735468==231311385)
dim(mer2)

#Active
act2_time<- act2[complete.cases(act2[ , time.var2]), ]

tmpA <- act2_time[,c("Connect_ID","d_914594314","d_832139544")]
tmpA$d_914594314 <- as.POSIXct(ymd_hms(tmpA$d_914594314))
tmpA$d_832139544 <- as.POSIXct(ymd_hms(tmpA$d_832139544))


tmpA$Mod2completionA <- difftime(tmpA$d_832139544, tmpA$d_914594314, units="mins")
summary(as.numeric(tmpA$Mod2completionA))   #normal for some of these to be negative, active parts. can get verified later on



#Passive
pas2_time<- pas2[complete.cases(pas2[ , time.var2]), ]


tmp2P <- pas2_time[,c("Connect_ID","d_914594314","d_832139544")]
tmp2P$d_914594314 <- as.POSIXct(ymd_hms(tmp2P$d_914594314))
tmp2P$d_832139544 <- as.POSIXct(ymd_hms(tmp2P$d_832139544))


tmp2P$Mod2completionP <- difftime(tmp2P$d_832139544, tmp2P$d_914594314, units="mins")
summary(as.numeric(tmp2P$Mod2completionP)) #good that these are all positive, passives NEED to be verified first 

#Total
mer2_time<- mer2[complete.cases(mer2[ , time.var2]), ]


tmp2T <- mer2_time[,c("Connect_ID","d_914594314","d_832139544")]
tmp2T$d_914594314 <- as.POSIXct(ymd_hms(tmp2T$d_914594314))
tmp2T$d_832139544 <- as.POSIXct(ymd_hms(tmp2T$d_832139544))


tmp2T$Mod2completionT <- difftime(tmp2T$d_832139544, tmp2T$d_914594314, units="mins")
summary(as.numeric(tmp2T$Mod2completionT))


```


```{r, echo=FALSE}

cat("Active(n=", dim(act2)[[1]], ")")
summary(as.numeric(tmpA$Mod2completionA))

cat("Passive(n=", dim(pas2)[[1]], ")")
summary(as.numeric(tmp2P$Mod2completionP))

cat("Total(n=", dim(mer2)[[1]], ")")
summary(as.numeric(tmp2T$Mod2completionT))

```
# 
## Module 3
### On or after all modules available 
```{r, include=FALSE}
# 3.	Time from verification to completion of each module (active, passive and total) 
#d_770257102 completed
time.var3 <- c("d_914594314","d_770257102")


#All verified participant totals, verified active total and verified passive total
act3 <- active_c_after %>% filter(d_976570371==231311385)
dim(act3)
pas3 <- passive_c_after %>% filter(d_976570371==231311385)
dim(pas3)
mer3 <- data_ccc_after %>% filter(d_976570371==231311385)
dim(mer3)

#Active
#act3_time <- act3[complete.cases(time.var3)]
act3_time<- act3[complete.cases(act3[ , time.var3]), ]


tmp3A <- act3_time[,c("Connect_ID","d_914594314","d_770257102")]
tmp3A$d_914594314 <- as.POSIXct(ymd_hms(tmp3A$d_914594314))
tmp3A$d_770257102 <- as.POSIXct(ymd_hms(tmp3A$d_770257102))


tmp3A$Mod3completionA <- difftime(tmp3A$d_770257102, tmp3A$d_914594314, units="mins")
summary(as.numeric(tmp3A$Mod3completionA))


#Passive
#pas3_time <- pas3[complete.cases(time.var3)]
pas3_time<- pas3[complete.cases(pas3[ , time.var3]), ]


Ptmp3A <- pas3_time[,c("Connect_ID","d_914594314","d_770257102")]
Ptmp3A$d_914594314 <- as.POSIXct(ymd_hms(Ptmp3A$d_914594314))
Ptmp3A$d_770257102 <- as.POSIXct(ymd_hms(Ptmp3A$d_770257102))


Ptmp3A$Mod3completionP <- difftime(Ptmp3A$d_770257102, Ptmp3A$d_914594314, units="mins")
summary(as.numeric(Ptmp3A$Mod3completionP))


#Total
#mer3_time <- mer3[complete.cases(time.var3)]
mer3_time<- mer3[complete.cases(mer3[ , time.var3]), ]


Ttmp3T <- mer3_time[,c("Connect_ID","d_914594314","d_770257102")]
Ttmp3T$d_914594314 <- as.POSIXct(ymd_hms(Ttmp3T$d_914594314))
Ttmp3T$d_770257102 <- as.POSIXct(ymd_hms(Ttmp3T$d_770257102))


Ttmp3T$Mod3completionT <- difftime(Ttmp3T$d_770257102, Ttmp3T$d_914594314, units="mins")
summary(as.numeric(Ttmp3T$Mod3completionT))

data_ccc$Connect_ID[which.max(Ttmp3T$Mod3completionT)]
data_ccc$Connect_ID[which.min(Ttmp3T$Mod3completionT)]
```

```{r, echo=FALSE}

cat("Active(n=", dim(act3)[[1]], ")")
summary(as.numeric(tmp3A$Mod3completionA))


cat("Passive(n=", dim(pas3)[[1]], ")")
summary(as.numeric(Ptmp3A$Mod3completionP))


cat("Total(n=", dim(mer3)[[1]], ")")
summary(as.numeric(Ttmp3T$Mod3completionT))
```
# 
## Module 4
### On or after all modules available 
```{r, include=FALSE}
# 3.	Time from verification to completion of each module (active, passive and total)  
#264644252 completion

time.var4 <- c("d_914594314","d_264644252")

#All verified participant totals, verified active total and verified passive total
act4 <- active_c_after %>%   filter(d_663265240==231311385)
dim(act4)
pas4 <- passive_c_after  %>% filter(d_663265240==231311385)
dim(pas4)
mer4 <- data_ccc_after %>% filter(d_663265240==231311385)
dim(mer4)


#Active
#act4_time <- act4[complete.cases(time.var4)]
act4_time<- act4[complete.cases(act4[ , time.var4]), ]


tmp4A <- act4_time[,c("Connect_ID","d_914594314","d_264644252")]
tmp4A$d_914594314 <- as.POSIXct(ymd_hms(tmp4A$d_914594314))
tmp4A$d_264644252 <- as.POSIXct(ymd_hms(tmp4A$d_264644252))


tmp4A$Mod4completionA <- difftime(tmp4A$d_264644252, tmp4A$d_914594314, units="mins")
summary(as.numeric(tmp4A$Mod4completionA))

#Passive
#pas4_time <- pas4[complete.cases(time.var4)]
pas4_time<- pas4[complete.cases(pas4[ , time.var4]), ]

Ptmp4A <- pas4_time[,c("Connect_ID","d_914594314","d_264644252")]
Ptmp4A$d_914594314 <- as.POSIXct(ymd_hms(Ptmp4A$d_914594314))
Ptmp4A$d_264644252 <- as.POSIXct(ymd_hms(Ptmp4A$d_264644252))


Ptmp4A$Mod4completionP <- difftime(Ptmp4A$d_264644252, Ptmp4A$d_914594314, units="mins")
summary(as.numeric(Ptmp4A$Mod4completionP))

#Total
#mer4_time <- mer4[complete.cases(time.var4)]
mer4_time<- mer4[complete.cases(mer4[ , time.var4]), ]


Ttmp4 <- mer4_time[,c("Connect_ID","d_914594314","d_264644252")]
Ttmp4$d_914594314 <- as.POSIXct(ymd_hms(Ttmp4$d_914594314))
Ttmp4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp4$d_264644252))


Ttmp4$Mod4completionT <- difftime(Ttmp4$d_264644252, Ttmp4$d_914594314, units="mins")
summary(as.numeric(Ttmp4$Mod4completionT))

```

```{r, echo=FALSE}

cat("Active(n=", dim(act4)[[1]], ")")
summary(as.numeric(tmp4A$Mod4completionA))

cat("Passive(n=", dim(pas4)[[1]], ")")
summary(as.numeric(Ptmp4A$Mod4completionP))

cat("Total(n=", dim(mer4)[[1]], ")")
summary(as.numeric(Ttmp4$Mod4completionT))

```

# 4.	Duration in minutes from start to submission for each module:  25, 50, 75 percentiles (active, passive, and total).  

# Also listed are percentages of activate/passive/total participants completing the module in different time ranges. Note, each module will be stratified into one table before all modules were available in prod, and one table after all modules were available in prod.  

# 
## Module 1 

### Before all modules available
```{r, include=FALSE, warning = FALSE}
#4.	Duration from start to submitted for each module (active_c, passive_c and total)  
#d_205553981 time stamp started
#d_517311251 time stamp finished 

time.var.1 <- c("d_205553981","d_517311251")


##BEFORE
#All participant totals, active_c total and passive_c total
sum(active_c_before$d_949302066==231311385, na.rm=TRUE)
sum(passive_c_before$d_949302066==231311385, na.rm=TRUE)
sum(data_ccc_before$d_949302066==231311385, na.rm=TRUE)

s4_1bA=sum(active_c_before$d_949302066==231311385, na.rm=TRUE)
s4_1bP=sum(passive_c_before$d_949302066==231311385, na.rm=TRUE)
s4_1bT=sum(data_ccc_before$d_949302066==231311385, na.rm=TRUE)

#active_c
act1= active_c_before %>% filter(active_c_before$d_949302066==231311385)
#act1_time <- act1[complete.cases(time.var.1)]
act1_time<- act1[complete.cases(act1[ , time.var.1]), ]


Atmp1 <- act1_time[,c("Connect_ID","d_205553981","d_517311251")]
Atmp1$d_205553981 <- as.POSIXct(ymd_hms(Atmp1$d_205553981))
Atmp1$d_517311251 <- as.POSIXct(ymd_hms(Atmp1$d_517311251))


Atmp1$Mod1completionA <- difftime(Atmp1$d_517311251, Atmp1$d_205553981, units="mins")
summary(as.numeric(Atmp1$Mod1completionA))

round((100*(sum(Atmp1$Mod1completionA<10)/sum(active_c$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Atmp1$Mod1completionA & Atmp1$Mod1completionA>10)/sum(active_c_before$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Atmp1$Mod1completionA & Atmp1$Mod1completionA>20)/sum(active_c_before$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Atmp1$Mod1completionA>30)/sum(active_c$d_949302066==231311385, na.rm=TRUE))), digits=2)

#passive_c
pas1= passive_c_before %>% filter(passive_c_before$d_949302066==231311385)
#pas1_time <- pas1[complete.cases(time.var.1)]
pas1_time<- pas1[complete.cases(pas1[ , time.var.1]), ]


Ptmp1 <- pas1_time[,c("Connect_ID","d_205553981","d_517311251")]
Ptmp1$d_205553981 <- as.POSIXct(ymd_hms(Ptmp1$d_205553981))
Ptmp1$d_517311251 <- as.POSIXct(ymd_hms(Ptmp1$d_517311251))


Ptmp1$Mod1completionP <- difftime(Ptmp1$d_517311251, Ptmp1$d_205553981, units="mins")
Ptmp1$Mod1completionP <- as.numeric(Ptmp1$Mod1completionP)
summary(Ptmp1$Mod1completionP)

round((100*(sum(Ptmp1$Mod1completionP<10, na.rm=TRUE)/sum(passive_c$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ptmp1$Mod1completionP & Ptmp1$Mod1completionP>10, na.rm=TRUE)/sum(passive_c_before$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ptmp1$Mod1completionP & Ptmp1$Mod1completionP>20, na.rm=TRUE)/sum(passive_c_before$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ptmp1$Mod1completionP>30, na.rm=TRUE)/sum(passive_c$d_949302066==231311385, na.rm=TRUE))), digits=2)


#Total
mer1= data_ccc_before %>% filter(data_ccc_before$d_949302066==231311385)
#mer1_time <- mer1[complete.cases(time.var.1)]
mer1_time<- mer1[complete.cases(mer1[ , time.var.1]), ]


Ttmp1 <- mer1_time[,c("Connect_ID","d_205553981","d_517311251", "d_512820379")]
Ttmp1$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1$d_205553981))
Ttmp1$d_517311251 <- as.POSIXct(ymd_hms(Ttmp1$d_517311251))


Ttmp1$Mod1completionT <- difftime(Ttmp1$d_517311251, Ttmp1$d_205553981, units="mins")
summary(as.numeric(Ttmp1$Mod1completionT))

round((100*(sum(Ttmp1$Mod1completionT<10, na.rm=TRUE)/sum(data_ccc$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp1$Mod1completionT & Ttmp1$Mod1completionT>10, na.rm=TRUE)/sum(data_ccc_before$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp1$Mod1completionT & Ttmp1$Mod1completionT>20, na.rm=TRUE)/sum(data_ccc_before$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp1$Mod1completionT>40, na.rm=TRUE)/sum(data_ccc$d_949302066==231311385, na.rm=TRUE))), digits=2)


#Make automated table
head(Ttmp1)
head(mer1$d_512820379)


Ttmp1b= Ttmp1 %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp1b)

ccc4_b1= Ttmp1b %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b1)

ccc4_b1= ccc4_b1 %>%  mutate(freq=if(!is.na(ccc4_b1$Connect_ID)){1})
head(ccc4_b1)
dim(ccc4_b1)[[1]]

ccc4_b1= ccc4_b1 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_b1)

ccc4_b1= ccc4_b1 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b1)

ccc4_b1$percentage= (ccc4_b1$freq/dim(ccc4_b1)[[1]])*100 
head(ccc4_b1) 

ccc4_b1$percentage.Active= (ccc4_b1$freq.Active/dim(ccc4_b1)[[1]])*100 
head(ccc4_b1)

ccc4_b1$percentage.Passive= (ccc4_b1$freq.Passive/dim(ccc4_b1)[[1]])*100 
head(ccc4_b1)

ccc4_b1 <- ccc4_b1[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_b1)



ccc4_b1 <- ccc4_b1 %>% mutate(time_frame=case_when(Mod1completionT<10  ~ "Completed in Under 10 Minutes",
                                                   20>Mod1completionT & Mod1completionT>10  ~ "Completed in 10-20 minutes",
                                                   30>Mod1completionT & Mod1completionT>20  ~ "Completed in 20-30 minutes",
                                                   Mod1completionT>30 ~ "Completed in 30+ minutes"))
head(ccc4_b1)


ccc4_b1_summary <- ccc4_b1 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc4_b1_summary)                                                                              
gt_print2A





```

```{r, echo=FALSE}
cat("Active(n=", s4_1bA, ")")
summary(as.numeric(Atmp1$Mod1completionA))

cat("Passive(n=", s4_1bP, ")")
summary(Ptmp1$Mod1completionP)

cat("Total(n=", s4_1bT, ")")
summary(as.numeric(Ttmp1$Mod1completionT))

```

```{r, echo=FALSE, warning=FALSE}
ccc4_b1_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 1 Completion Time of Verified Participants (Before)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
  tab_footnote(
    footnote = "Verification completed prior to July 5,2022 when all modules became available in prod") %>%
  tab_spanner(
    label="Active",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
  summary_rows(
    #    groups= T, 
    columns =  c(freq.Active,freq.Passive, freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% 
  summary_rows(
    #    groups= T, 
    columns = c(percentage.Active, percentage.Passive),
    fns= list(
      Sum= ~sum(.))) %>%
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```


### On or after all module available 
```{r, include=FALSE}
##AFTER
#All participant totals, active_c total and passive_c total
sum(active_c_after$d_949302066==231311385, na.rm=TRUE)
sum(passive_c_after$d_949302066==231311385, na.rm=TRUE)
sum(data_ccc_after$d_949302066==231311385, na.rm=TRUE)

s4_1aA=sum(active_c_after$d_949302066==231311385, na.rm=TRUE)
s4_1aP=sum(passive_c_after$d_949302066==231311385, na.rm=TRUE)
s4_1aT=sum(data_ccc_after$d_949302066==231311385, na.rm=TRUE)

#active_c
act1= active_c_after %>% filter(active_c_after$d_949302066==231311385)
#act1_time <- act1[complete.cases(time.var.1)]
act1_time<- act1[complete.cases(act1[ , time.var.1]), ]


Atmp1 <- act1_time[,c("Connect_ID","d_205553981","d_517311251")]
Atmp1$d_205553981 <- as.POSIXct(ymd_hms(Atmp1$d_205553981))
Atmp1$d_517311251 <- as.POSIXct(ymd_hms(Atmp1$d_517311251))


Atmp1$Mod1completionA <- difftime(Atmp1$d_517311251, Atmp1$d_205553981, units="mins")
summary(as.numeric(Atmp1$Mod1completionA))

round((100*(sum(Atmp1$Mod1completionA<10)/sum(active_c$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Atmp1$Mod1completionA & Atmp1$Mod1completionA>10)/sum(active_c_after$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Atmp1$Mod1completionA & Atmp1$Mod1completionA>20)/sum(active_c_after$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Atmp1$Mod1completionA>30)/sum(active_c$d_949302066==231311385, na.rm=TRUE))), digits=2)

#passive_c
pas1= passive_c_after %>% filter(passive_c_after$d_949302066==231311385)
#pas1_time <- pas1[complete.cases(time.var.1)]
pas1_time<- pas1[complete.cases(pas1[ , time.var.1]), ]


Ptmp1 <- pas1_time[,c("Connect_ID","d_205553981","d_517311251")]
Ptmp1$d_205553981 <- as.POSIXct(ymd_hms(Ptmp1$d_205553981))
Ptmp1$d_517311251 <- as.POSIXct(ymd_hms(Ptmp1$d_517311251))


Ptmp1$Mod1completionP <- difftime(Ptmp1$d_517311251, Ptmp1$d_205553981, units="mins")
Ptmp1$Mod1completionP <- as.numeric(Ptmp1$Mod1completionP)
summary(Ptmp1$Mod1completionP)

round((100*(sum(Ptmp1$Mod1completionP<10, na.rm=TRUE)/sum(passive_c$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ptmp1$Mod1completionP & Ptmp1$Mod1completionP>10, na.rm=TRUE)/sum(passive_c_after$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ptmp1$Mod1completionP & Ptmp1$Mod1completionP>20, na.rm=TRUE)/sum(passive_c_after$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ptmp1$Mod1completionP>30, na.rm=TRUE)/sum(passive_c$d_949302066==231311385, na.rm=TRUE))), digits=2)


#Total
mer1a= data_ccc_after %>% filter(data_ccc_after$d_949302066==231311385)
#mer1a_time <- mer1a[complete.cases(time.var.1)]
mer1a_time<- mer1a[complete.cases(mer1a[ , time.var.1]), ]


Ttmp1a <- mer1a_time[,c("Connect_ID","d_205553981","d_517311251", "d_512820379")]
Ttmp1a$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1a$d_205553981))
Ttmp1a$d_517311251 <- as.POSIXct(ymd_hms(Ttmp1a$d_517311251))


Ttmp1a$Mod1completionT_A <- difftime(Ttmp1a$d_517311251, Ttmp1a$d_205553981, units="mins")
summary(as.numeric(Ttmp1a$Mod1completionT_A))

round((100*(sum(Ttmp1a$Mod1completionT_A<10, na.rm=TRUE)/sum(data_ccc$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp1a$Mod1completionT_A & Ttmp1a$Mod1completionT_A>10, na.rm=TRUE)/sum(data_ccc_after$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp1a$Mod1completionT_A & Ttmp1a$Mod1completionT_A>20, na.rm=TRUE)/sum(data_ccc_after$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp1a$Mod1completionT_A>30, na.rm=TRUE)/sum(data_ccc$d_949302066==231311385, na.rm=TRUE))), digits=2)


#Make automatic table
head(Ttmp1a)


Ttmp1a= Ttmp1a %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp1a)

ccc4_a1= Ttmp1a %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a1)

ccc4_a1= ccc4_a1 %>%  mutate(freq=if(!is.na(ccc4_a1$Connect_ID)){1})
head(ccc4_a1)
dim(ccc4_a1)[[1]]

ccc4_a1= ccc4_a1 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_a1)

ccc4_a1= ccc4_a1 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a1)

ccc4_a1$percentage= (ccc4_a1$freq/dim(ccc4_a1)[[1]])*100 
head(ccc4_a1) 

ccc4_a1$percentage.Active= (ccc4_a1$freq.Active/dim(ccc4_a1)[[1]])*100 
head(ccc4_a1)

ccc4_a1$percentage.Passive= (ccc4_a1$freq.Passive/dim(ccc4_a1)[[1]])*100 
head(ccc4_a1)

ccc4_a1 <- ccc4_a1[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_a1)



ccc4_a1 <- ccc4_a1 %>% mutate(time_frame=case_when(Mod1completionT_A<10  ~ "Completed in Under 10 Minutes",
                                                   20>Mod1completionT_A & Mod1completionT_A>10  ~ "Completed in 10-20 minutes",
                                                   30>Mod1completionT_A & Mod1completionT_A>20  ~ "Completed in 20-30 minutes",
                                                   Mod1completionT_A>30 ~ "Completed in 30+ minutes"))
head(ccc4_a1)


ccc4_a1_summary <- ccc4_a1 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc4_a1_summary)                                                                              
gt_print2A

```

```{r, echo=FALSE}

cat("Active(n=", s4_1aA, ")")
summary(as.numeric(Atmp1$Mod1completionA))

cat("Passive(n=", s4_1aP, ")")
summary(Ptmp1$Mod1completionP)

cat("Total(n=", s4_1aT, ")")
summary(as.numeric(Ttmp1a$Mod1completionT_A))

```

```{r, echo=FALSE, warning = FALSE}
ccc4_a1_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 1 Completion Time of Verified Participants (On or After)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all modules became available in prod") %>%
  tab_spanner(
    label="Active",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
  summary_rows(
    #    groups= T, 
    columns =  c(freq.Active,freq.Passive, freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% 
  summary_rows(
    #    groups= T, 
    columns = c(percentage.Active, percentage.Passive),
    fns= list(
      Sum= ~sum(.))) %>%
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```

# 
## Module 2

### Before all modules available 
```{r, include=FALSE, warning = FALSE}
time.var.2 <- c("d_541836531","d_832139544")

##BEFORE
#All participant totals, active total and passive total
sum(active_c_before$d_536735468==231311385, na.rm=TRUE)
sum(passive_c_before$d_536735468==231311385, na.rm=TRUE)
sum(data_ccc_before$d_536735468==231311385, na.rm=TRUE)

s4_2bA=sum(active_c_before$d_536735468==231311385, na.rm=TRUE)
s4_2bP=sum(passive_c_before$d_536735468==231311385, na.rm=TRUE)
s4_2bT=sum(data_ccc_before$d_536735468==231311385, na.rm=TRUE)

#Active
actm2= active_c_before %>% filter(active_c_before$d_536735468==231311385)
#actm2_time <- actm2[complete.cases(time.var.2)]
actm2_time<- actm2[complete.cases(actm2[ , time.var.2]), ]


tmp <- actm2_time[,c("Connect_ID","d_541836531","d_832139544")]
tmp$d_541836531 <- as.POSIXct(ymd_hms(tmp$d_541836531))
tmp$d_832139544 <- as.POSIXct(ymd_hms(tmp$d_832139544))


tmp$Mod2completionA <- difftime(tmp$d_832139544, tmp$d_541836531, units="mins")
summary(as.numeric(tmp$Mod2completionA))

round((100*(sum(tmp$Mod2completionA<10, na.rm=TRUE)/sum(active_c$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp$Mod2completionA & tmp$Mod2completionA>10, na.rm=TRUE)/sum(active_c_before$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp$Mod2completionA & tmp$Mod2completionA>20, na.rm=TRUE)/sum(active_c_before$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp$Mod2completionA>30, na.rm=TRUE)/sum(active_c$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Passive
pasm2= passive_c_before %>% filter(passive_c_before$d_536735468==231311385)
#pasm2_time <- pasm2[complete.cases(time.var.2)]
pasm2_time<- pasm2[complete.cases(pasm2[ , time.var.2]), ]


ptmp <- pasm2_time[,c("Connect_ID","d_541836531","d_832139544")]
ptmp$d_541836531 <- as.POSIXct(ymd_hms(ptmp$d_541836531))
ptmp$d_832139544 <- as.POSIXct(ymd_hms(ptmp$d_832139544))


ptmp$Mod2completionP <- difftime(ptmp$d_832139544, ptmp$d_541836531, units="mins")
summary(as.numeric(ptmp$Mod2completionP))

round((100*(sum(ptmp$Mod2completionP<10, na.rm=TRUE)/sum(passive_c$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp$Mod2completionP & ptmp$Mod2completionP>10, na.rm=TRUE)/sum(passive_c_before$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp$Mod2completionP & ptmp$Mod2completionP>20, na.rm=TRUE)/sum(passive_c_before$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp$Mod2completionP>30, na.rm=TRUE)/sum(passive_c$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Total
merm2= data_ccc_before %>% filter(data_ccc_before$d_536735468==231311385)
#merm2_time <- merm2[complete.cases(time.var.2)]
merm2_time<- merm2[complete.cases(merm2[ , time.var.2]), ]


Ttmp2 <- merm2_time[,c("Connect_ID","d_541836531","d_832139544", "d_512820379")]
Ttmp2$d_541836531 <- as.POSIXct(ymd_hms(Ttmp2$d_541836531))
Ttmp2$d_832139544 <- as.POSIXct(ymd_hms(Ttmp2$d_832139544))


Ttmp2$Mod2completionT_B <- difftime(Ttmp2$d_832139544, Ttmp2$d_541836531, units="mins")
summary(as.numeric(Ttmp2$Mod2completionT_B))

round((100*(sum(Ttmp2$Mod2completionT_B<10, na.rm=TRUE)/sum(data_ccc$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp2$Mod2completionT_B & Ttmp2$Mod2completionT_B>10, na.rm=TRUE)/sum(data_ccc_before$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp2$Mod2completionT_B & Ttmp2$Mod2completionT_B>20, na.rm=TRUE)/sum(data_ccc_before$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp2$Mod2completionT_B>30, na.rm=TRUE)/sum(data_ccc$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Make an automatic table
head(Ttmp2)
head(mer1$d_512820379)


Ttmp2b= Ttmp2 %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp2b)

ccc4_b2= Ttmp2b %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b2)

ccc4_b2= ccc4_b2 %>%  mutate(freq=if(!is.na(ccc4_b2$Connect_ID)){1})
head(ccc4_b2)
dim(ccc4_b2)[[1]]

ccc4_b2= ccc4_b2 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_b2)

ccc4_b2= ccc4_b2 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b2)

ccc4_b2$percentage= (ccc4_b2$freq/dim(ccc4_b2)[[1]])*100 
head(ccc4_b2) 

ccc4_b2$percentage.Active= (ccc4_b2$freq.Active/dim(ccc4_b2)[[1]])*100 
head(ccc4_b2)

ccc4_b2$percentage.Passive= (ccc4_b2$freq.Passive/dim(ccc4_b2)[[1]])*100 
head(ccc4_b2)

ccc4_b2 <- ccc4_b2[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_b2)



ccc4_b2 <- ccc4_b2 %>% mutate(time_frame=case_when(Mod2completionT_B<10  ~ "Completed in Under 10 Minutes",
                                               20>Mod2completionT_B & Mod2completionT_B>10  ~ "Completed in 10-20 minutes",
                                               30>Mod2completionT_B & Mod2completionT_B>20  ~ "Completed in 20-30 minutes",
                                               Mod2completionT_B>30 ~ "Completed in 30+ minutes"))
head(ccc4_b2)


ccc4_b2_summary <- ccc4_b2 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print4B <- gt(ccc4_b2_summary)                                                                              
gt_print4B





```

```{r, echo=FALSE}

cat("Active(n=", s4_2bA, ")")
summary(as.numeric(tmp$Mod2completionA))

cat("Passive(n=", s4_2bP, ")")
summary(as.numeric(ptmp$Mod2completionP))

cat("Total(n=", s4_2bT, ")")
summary(as.numeric(Ttmp2$Mod2completionT_B))

```

```{r, echo=FALSE, warning = FALSE}
ccc4_b2_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 2 Completion Time of Verified Participants (Before)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
  tab_footnote(
    footnote = "Verification completed prior to July 5,2022 when all modules became available in prod") %>%
  tab_spanner(
    label="Active",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
  summary_rows(
    #    groups= T, 
    columns =  c(freq.Active,freq.Passive, freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% 
  summary_rows(
    #    groups= T, 
    columns = c(percentage.Active, percentage.Passive),
    fns= list(
      Sum= ~sum(.))) %>%
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```

### On or after all modules available
```{r, include=FALSE, warning = FALSE}
##AFTER
#All participant totals, active total and passive total
sum(active_c_after$d_536735468==231311385, na.rm=TRUE)
sum(passive_c_after$d_536735468==231311385, na.rm=TRUE)
sum(data_ccc_after$d_536735468==231311385, na.rm=TRUE)


s4_2aA=sum(active_c_after$d_536735468==231311385, na.rm=TRUE)
s4_2aP=sum(passive_c_after$d_536735468==231311385, na.rm=TRUE)
s4_2aT=sum(data_ccc_after$d_536735468==231311385, na.rm=TRUE)


#Active
actm2= active_c_after %>% filter(active_c_after$d_536735468==231311385)
#actm2_time <- actm2[complete.cases(time.var.2)]
actm2_time<- actm2[complete.cases(actm2[ , time.var.2]), ]


tmp <- actm2_time[,c("Connect_ID","d_541836531","d_832139544")]
tmp$d_541836531 <- as.POSIXct(ymd_hms(tmp$d_541836531))
tmp$d_832139544 <- as.POSIXct(ymd_hms(tmp$d_832139544))


tmp$Mod2completionA <- difftime(tmp$d_832139544, tmp$d_541836531, units="mins")
summary(as.numeric(tmp$Mod2completionA))

round((100*(sum(tmp$Mod2completionA<10, na.rm=TRUE)/sum(active_c$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp$Mod2completionA & tmp$Mod2completionA>10, na.rm=TRUE)/sum(active_c_after$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp$Mod2completionA & tmp$Mod2completionA>20, na.rm=TRUE)/sum(active_c_after$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp$Mod2completionA>30, na.rm=TRUE)/sum(active_c$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Passive
pasm2= passive_c_after %>% filter(passive_c_after$d_536735468==231311385)
#pasm2_time <- pasm2[complete.cases(time.var.2)]
pasm2_time<- pasm2[complete.cases(pasm2[ , time.var.2]), ]


ptmp <- pasm2_time[,c("Connect_ID","d_541836531","d_832139544")]
ptmp$d_541836531 <- as.POSIXct(ymd_hms(ptmp$d_541836531))
ptmp$d_832139544 <- as.POSIXct(ymd_hms(ptmp$d_832139544))


ptmp$Mod2completionP <- difftime(ptmp$d_832139544, ptmp$d_541836531, units="mins")
summary(as.numeric(ptmp$Mod2completionP))

round((100*(sum(ptmp$Mod2completionP<10, na.rm=TRUE)/sum(passive_c$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp$Mod2completionP & ptmp$Mod2completionP>10, na.rm=TRUE)/sum(passive_c_after$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp$Mod2completionP & ptmp$Mod2completionP>20, na.rm=TRUE)/sum(passive_c_after$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp$Mod2completionP>30, na.rm=TRUE)/sum(passive_c$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Total
merm2= data_ccc_after %>% filter(data_ccc_after$d_536735468==231311385)
#merm2_time <- merm2[complete.cases(time.var.2)]
merm2_time<- merm2[complete.cases(merm2[ , time.var.2]), ]


Ttmp2A <- merm2_time[,c("Connect_ID","d_541836531","d_832139544", "d_512820379")]
Ttmp2A$d_541836531 <- as.POSIXct(ymd_hms(Ttmp2A$d_541836531))
Ttmp2A$d_832139544 <- as.POSIXct(ymd_hms(Ttmp2A$d_832139544))


Ttmp2A$Mod2completionT_A <- difftime(Ttmp2A$d_832139544, Ttmp2A$d_541836531, units="mins")
summary(as.numeric(Ttmp2A$Mod2completionT_A))

round((100*(sum(Ttmp2A$Mod2completionT_A<10, na.rm=TRUE)/sum(data_ccc$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp2A$Mod2completionT_A & Ttmp2A$Mod2completionT_A>10, na.rm=TRUE)/sum(data_ccc_after$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp2A$Mod2completionT_A & Ttmp2A$Mod2completionT_A>20, na.rm=TRUE)/sum(data_ccc_after$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp2A$Mod2completionT_A>30, na.rm=TRUE)/sum(data_ccc$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Make an automatic table
head(Ttmp2A)


Ttmp2A= Ttmp2A %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp2A)

ccc4_a2= Ttmp2A %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a2)

ccc4_a2= ccc4_a2 %>%  mutate(freq=if(!is.na(ccc4_a2$Connect_ID)){1})
head(ccc4_a2)
dim(ccc4_a2)[[1]]

ccc4_a2= ccc4_a2 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_a2)

ccc4_a2= ccc4_a2 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a2)

ccc4_a2$percentage= (ccc4_a2$freq/dim(ccc4_a2)[[1]])*100 
head(ccc4_a2) 

ccc4_a2$percentage.Active= (ccc4_a2$freq.Active/dim(ccc4_a2)[[1]])*100 
head(ccc4_a2)

ccc4_a2$percentage.Passive= (ccc4_a2$freq.Passive/dim(ccc4_a2)[[1]])*100 
head(ccc4_a2)

ccc4_a2 <- ccc4_a2[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_a2)



ccc4_a2 <- ccc4_a2 %>% mutate(time_frame=case_when(Mod2completionT_A<10  ~ "Completed in Under 10 Minutes",
                                                   20>Mod2completionT_A & Mod2completionT_A>10  ~ "Completed in 10-20 minutes",
                                                   30>Mod2completionT_A & Mod2completionT_A>20  ~ "Completed in 20-30 minutes",
                                                   Mod2completionT_A>30 ~ "Completed in 30+ minutes"))
head(ccc4_a2)

ccc4_a2_summary <- ccc4_a2 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc4_a2_summary)                                                                              
gt_print2A

```

```{r, echo=FALSE}

cat("Active(n=", s4_2aA, ")")
summary(as.numeric(tmp$Mod2completionA))

cat("Passive(n=", s4_2aP, ")")
summary(as.numeric(ptmp$Mod2completionP))

cat("Total(n=", s4_2aT, ")")
summary(as.numeric(Ttmp2A$Mod2completionT_A))
```

```{r, echo=FALSE, warning = FALSE}

ccc4_a2_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 2 Completion Time of Verified Participants (On or After)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all modules became available in prod") %>%
  tab_spanner(
    label="Active",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
  summary_rows(
    #    groups= T, 
    columns =  c(freq.Active,freq.Passive, freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% 
  summary_rows(
    #    groups= T, 
    columns = c(percentage.Active, percentage.Passive),
    fns= list(
      Sum= ~sum(.))) %>%
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```

# 
## Module 3
### Before all modules available
```{r, include= FALSE, warning=FALSE}
#d_770257102 completed
#d_386488297 start 

time.var.3 <- c("d_386488297","d_770257102")

##BEFORE
#All particiapnt totals, active total and passive total
sum(active_c_before$d_976570371==231311385, na.rm=TRUE)
sum(passive_c_before$d_976570371==231311385, na.rm=TRUE)
sum(data_ccc_before$d_976570371==231311385, na.rm=TRUE)

s4_3bA=sum(active_c_before$d_976570371==231311385, na.rm=TRUE)
s4_3bP=sum(passive_c_before$d_976570371==231311385, na.rm=TRUE)
s4_3bT=sum(data_ccc_before$d_976570371==231311385, na.rm=TRUE)


#Active
actm3= active_c_before %>% filter(active_c_before$d_976570371==231311385)
#actm3_time <- actm3[complete.cases(time.var.3)]
actm3_time<- actm3[complete.cases(actm3[ , time.var.3]), ]


tmp.3A <- actm3_time[,c("Connect_ID","d_386488297","d_770257102")]
tmp.3A$d_386488297 <- as.POSIXct(ymd_hms(tmp.3A$d_386488297))
tmp.3A$d_770257102 <- as.POSIXct(ymd_hms(tmp.3A$d_770257102))


tmp.3A$Mod3completionA <- difftime(tmp.3A$d_770257102, tmp.3A$d_386488297, units="mins")
summary(as.numeric(tmp.3A$Mod3completionA))

round((100*(sum(tmp.3A$Mod3completionA<10, na.rm=TRUE)/sum(active_c$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp.3A$Mod3completionA & tmp.3A$Mod3completionA>10, na.rm=TRUE)/sum(active_c_before$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp.3A$Mod3completionA & tmp.3A$Mod3completionA>20, na.rm=TRUE)/sum(active_c_before$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp.3A$Mod3completionA>30, na.rm=TRUE)/sum(active_c$d_976570371==231311385, na.rm=TRUE))), digits=2)

#Passive
pasm3= passive_c_before %>% filter(passive_c_before$d_976570371==231311385)
#pasm3_time <- pasm3[complete.cases(time.var.3)]
pasm3_time<- pasm3[complete.cases(pasm3[ , time.var.3]), ]


ptmp3 <- pasm3_time[,c("Connect_ID","d_386488297","d_770257102")]
ptmp3$d_386488297 <- as.POSIXct(ymd_hms(ptmp3$d_386488297))
ptmp3$d_770257102 <- as.POSIXct(ymd_hms(ptmp3$d_770257102))


ptmp3$Mod3completionP <- difftime(ptmp3$d_770257102, ptmp3$d_386488297, units="mins")
summary(as.numeric(ptmp3$Mod3completionP))

round((100*(sum(ptmp3$Mod3completionP<10, na.rm=TRUE)/sum(passive_c$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp3$Mod3completionP & ptmp3$Mod3completionP>10, na.rm=TRUE)/sum(passive_c_before$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp3$Mod3completionP & ptmp3$Mod3completionP>20, na.rm=TRUE)/sum(passive_c_before$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp3$Mod3completionP>30, na.rm=TRUE)/sum(passive_c$d_976570371==231311385, na.rm=TRUE))), digits=2)

#Total
#Total
merm3= data_ccc_before %>% filter(data_ccc_before$d_976570371==231311385)
#merm3_time <- merm3[complete.cases(time.var.3)]
merm3_time<- merm3[complete.cases(merm3[ , time.var.3]), ]


Ttmp3 <- merm3_time[,c("Connect_ID","d_386488297","d_770257102", "d_512820379")]
Ttmp3$d_386488297 <- as.POSIXct(ymd_hms(Ttmp3$d_386488297))
Ttmp3$d_770257102 <- as.POSIXct(ymd_hms(Ttmp3$d_770257102))


Ttmp3$Mod3completionT_B <- difftime(Ttmp3$d_770257102, Ttmp3$d_386488297, units="mins")
summary(as.numeric(Ttmp3$Mod3completionT_B))

round((100*(sum(Ttmp3$Mod3completionT_B<10, na.rm=TRUE)/sum(data_ccc$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp3$Mod3completionT_B & Ttmp3$Mod3completionT_B>10, na.rm=TRUE)/sum(data_ccc_before$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp3$Mod3completionT_B & Ttmp3$Mod3completionT_B>20, na.rm=TRUE)/sum(data_ccc_before$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp3$Mod3completionT_B>30, na.rm=TRUE)/sum(data_ccc$d_976570371==231311385, na.rm=TRUE))), digits=2)


#Make an automatic table
head(Ttmp3)


Ttmp3b= Ttmp3 %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp3b)

ccc4_b3= Ttmp3b %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b3)

ccc4_b3= ccc4_b3 %>%  mutate(freq=if(!is.na(ccc4_b3$Connect_ID)){1})
head(ccc4_b3)
dim(ccc4_b3)[[1]]

ccc4_b3= ccc4_b3 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_b3)

ccc4_b3= ccc4_b3 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b3)

ccc4_b3$percentage= (ccc4_b3$freq/dim(ccc4_b3)[[1]])*100 
head(ccc4_b3) 

ccc4_b3$percentage.Active= (ccc4_b3$freq.Active/dim(ccc4_b3)[[1]])*100 
head(ccc4_b3)

ccc4_b3$percentage.Passive= (ccc4_b3$freq.Passive/dim(ccc4_b3)[[1]])*100 
head(ccc4_b3)

ccc4_b3 <- ccc4_b3[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_b3)



ccc4_b3 <- ccc4_b3 %>% mutate(time_frame=case_when(Mod3completionT_B<10  ~ "Completed in Under 10 Minutes",
                                               20>Mod3completionT_B & Mod3completionT_B>10  ~ "Completed in 10-20 minutes",
                                               30>Mod3completionT_B & Mod3completionT_B>20  ~ "Completed in 20-30 minutes",
                                               Mod3completionT_B>30 ~ "Completed in 30+ minutes"))
head(ccc4_b3)


ccc4_b3_summary <- ccc4_b3 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print4B <- gt(ccc4_b3_summary)                                                                              
gt_print4B



```

```{r, echo=FALSE}

cat("Active(n=", s4_3bA, ")")
summary(as.numeric(tmp.3A$Mod3completionA))

cat("Passive(n=", s4_3bP, ")")
summary(as.numeric(ptmp3$Mod3completionP))

cat("Total(n=", s4_3bT, ")")
summary(as.numeric(Ttmp3$Mod3completionT_B))

```

```{r, echo=FALSE, warning = FALSE}
ccc4_b3_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 3 Completion Time of Verified Participants (Before)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
  tab_footnote(
    footnote = "Verification completed prior to July 5,2022 when all modules became available in prod") %>%
  tab_spanner(
    label="Active",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
  summary_rows(
    #    groups= T, 
    columns =  c(freq.Active,freq.Passive, freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% 
  summary_rows(
    #    groups= T, 
    columns = c(percentage.Active, percentage.Passive),
    fns= list(
      Sum= ~sum(.))) %>%
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```


### On or after all modules available
```{r, include= FALSE, warning=FALSE}
##AFTER
#All participant totals, active total and passive total
sum(active_c_after$d_976570371==231311385, na.rm=TRUE)
sum(passive_c_after$d_976570371==231311385, na.rm=TRUE)
sum(data_ccc_after$d_976570371==231311385, na.rm=TRUE)

s4_3aA=sum(active_c_after$d_976570371==231311385, na.rm=TRUE)
s4_3aP=sum(passive_c_after$d_976570371==231311385, na.rm=TRUE)
s4_3aT=sum(data_ccc_after$d_976570371==231311385, na.rm=TRUE)

#Active
actm3= active_c_after %>% filter(active_c_after$d_976570371==231311385)
#actm3_time <- actm3[complete.cases(time.var.3)]
actm3_time<- actm3[complete.cases(actm3[ , time.var.3]), ]


tmp.3A <- actm3_time[,c("Connect_ID","d_386488297","d_770257102")]
tmp.3A$d_386488297 <- as.POSIXct(ymd_hms(tmp.3A$d_386488297))
tmp.3A$d_770257102 <- as.POSIXct(ymd_hms(tmp.3A$d_770257102))


tmp.3A$Mod3completionA <- difftime(tmp.3A$d_770257102, tmp.3A$d_386488297, units="mins")
summary(as.numeric(tmp.3A$Mod3completionA))

round((100*(sum(tmp.3A$Mod3completionA<10, na.rm=TRUE)/sum(active_c$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp.3A$Mod3completionA & tmp.3A$Mod3completionA>10, na.rm=TRUE)/sum(active_c_after$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp.3A$Mod3completionA & tmp.3A$Mod3completionA>20, na.rm=TRUE)/sum(active_c_after$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp.3A$Mod3completionA>30, na.rm=TRUE)/sum(active_c$d_976570371==231311385, na.rm=TRUE))), digits=2)

#Passive
pasm3= passive_c_after %>% filter(passive_c_after$d_976570371==231311385)
#pasm3_time <- pasm3[complete.cases(time.var.3)]
pasm3_time<- pasm3[complete.cases(pasm3[ , time.var.3]), ]


ptmp3 <- pasm3_time[,c("Connect_ID","d_386488297","d_770257102")]
ptmp3$d_386488297 <- as.POSIXct(ymd_hms(ptmp3$d_386488297))
ptmp3$d_770257102 <- as.POSIXct(ymd_hms(ptmp3$d_770257102))


ptmp3$Mod3completionP <- difftime(ptmp3$d_770257102, ptmp3$d_386488297, units="mins")
summary(as.numeric(ptmp3$Mod3completionP))

round((100*(sum(ptmp3$Mod3completionP<10, na.rm=TRUE)/sum(passive_c$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp3$Mod3completionP & ptmp3$Mod3completionP>10, na.rm=TRUE)/sum(passive_c_after$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp3$Mod3completionP & ptmp3$Mod3completionP>20, na.rm=TRUE)/sum(passive_c_after$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp3$Mod3completionP>30, na.rm=TRUE)/sum(passive_c$d_976570371==231311385, na.rm=TRUE))), digits=2)

#Total
#Total
merm3= data_ccc_after %>% filter(data_ccc_after$d_976570371==231311385)
#merm3_time <- merm3[complete.cases(time.var.3)]
merm3_time<- merm3[complete.cases(merm3[ , time.var.3]), ]


Ttmp3A <- merm3_time[,c("Connect_ID","d_386488297","d_770257102", "d_512820379")]
Ttmp3A$d_386488297 <- as.POSIXct(ymd_hms(Ttmp3A$d_386488297))
Ttmp3A$d_770257102 <- as.POSIXct(ymd_hms(Ttmp3A$d_770257102))


Ttmp3A$Mod3completionT_A <- difftime(Ttmp3A$d_770257102, Ttmp3A$d_386488297, units="mins")
summary(as.numeric(Ttmp3A$Mod3completionT_A))

round((100*(sum(Ttmp3A$Mod3completionT_A<10, na.rm=TRUE)/sum(data_ccc$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp3A$Mod3completionT_A & Ttmp3A$Mod3completionT_A>10, na.rm=TRUE)/sum(data_ccc_after$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp3A$Mod3completionT_A & Ttmp3A$Mod3completionT_A>20, na.rm=TRUE)/sum(data_ccc_after$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp3A$Mod3completionT_A>30, na.rm=TRUE)/sum(data_ccc$d_976570371==231311385, na.rm=TRUE))), digits=2)


#Make an automatic table
head(Ttmp3A)


Ttmp3A= Ttmp3A %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp3A)

ccc4_a3= Ttmp3A %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a3)

ccc4_a3= ccc4_a3 %>%  mutate(freq=if(!is.na(ccc4_a3$Connect_ID)){1})
head(ccc4_a3)
dim(ccc4_a3)[[1]]

ccc4_a3= ccc4_a3 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_a3)

ccc4_a3= ccc4_a3 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a3)

ccc4_a3$percentage= (ccc4_a3$freq/dim(ccc4_a3)[[1]])*100 
head(ccc4_a3) 

ccc4_a3$percentage.Active= (ccc4_a3$freq.Active/dim(ccc4_a3)[[1]])*100 
head(ccc4_a3)

ccc4_a3$percentage.Passive= (ccc4_a3$freq.Passive/dim(ccc4_a3)[[1]])*100 
head(ccc4_a3)

ccc4_a3 <- ccc4_a3[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_a3)



ccc4_a3 <- ccc4_a3 %>% mutate(time_frame=case_when(Mod3completionT_A<10  ~ "Completed in Under 10 Minutes",
                                                   20>Mod3completionT_A & Mod3completionT_A>10  ~ "Completed in 10-20 minutes",
                                                   30>Mod3completionT_A & Mod3completionT_A>20  ~ "Completed in 20-30 minutes",
                                                   Mod3completionT_A>30 ~ "Completed in 30+ minutes"))
head(ccc4_a3)

ccc4_a3_summary <- ccc4_a3 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc4_a3_summary)                                                                              
gt_print2A




```

```{r, echo=FALSE}

summary(as.numeric(tmp.3A$Mod3completionA))
cat("Active(n=", s4_3aA, ")")

summary(as.numeric(ptmp3$Mod3completionP))
cat("Passive(n=", s4_3aP, ")")

summary(as.numeric(Ttmp3A$Mod3completionT_A))
cat("Total(n=", s4_3aT, ")")
```

```{r, echo=FALSE, warning = FALSE}
ccc4_a3_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 3 Completion Time of Verified Participants (On or After)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all modules became available in prod") %>%
  tab_spanner(
    label="Active",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
  summary_rows(
    #    groups= T, 
    columns =  c(freq.Active,freq.Passive, freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% 
  summary_rows(
    #    groups= T, 
    columns = c(percentage.Active, percentage.Passive),
    fns= list(
      Sum= ~sum(.))) %>%
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```
# 
## Module 4
### Before all modules available
```{r, include= FALSE, warning=FALSE}
# 4.	Duration from start to submitted for each module (active, passive and total) 
#264644252 completion
#452942800 start 
time.var.4 <- c("d_452942800","d_264644252")


##BEFORE
#All participant totals, active total and passive total
sum(active_c_before$d_663265240==231311385, na.rm=TRUE)
sum(passive_c_before$d_663265240==231311385, na.rm=TRUE)
sum(data_ccc_before$d_663265240==231311385, na.rm=TRUE)

s4_4bA=sum(active_c_before$d_663265240==231311385, na.rm=TRUE)
s4_4bP=sum(passive_c_before$d_663265240==231311385, na.rm=TRUE)
s4_4bT=sum(data_ccc_before$d_663265240==231311385, na.rm=TRUE)

#Active
actm4= active_c_before %>% filter(active_c_before$d_663265240==231311385)
#actm4_time <- actm4[complete.cases(time.var.4)]
actm4_time<- actm4[complete.cases(actm4[ , time.var.4]), ]


tmp.4 <- actm4_time[,c("Connect_ID","d_452942800","d_264644252")]
tmp.4$d_452942800 <- as.POSIXct(ymd_hms(tmp.4$d_452942800))
tmp.4$d_264644252 <- as.POSIXct(ymd_hms(tmp.4$d_264644252))


tmp.4$Mod4completionA <- difftime(tmp.4$d_264644252, tmp.4$d_452942800, units="mins")
summary(as.numeric(tmp.4$Mod4completionA))

round((100*(sum(tmp.4$Mod4completionA<10, na.rm=TRUE)/sum(active_c$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp.4$Mod4completionA & tmp.4$Mod4completionA>10, na.rm=TRUE)/sum(active_c_before$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp.4$Mod4completionA & tmp.4$Mod4completionA>20, na.rm=TRUE)/sum(active_c_before$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp.4$Mod4completionA>30, na.rm=TRUE)/sum(active_c$d_663265240==231311385, na.rm=TRUE))), digits=2)


#Passive
pasm4= passive_c_before %>% filter(passive_c_before$d_663265240==231311385)
#pasm4_time <- pasm4[complete.cases(time.var.4)]
pasm4_time<- pasm4[complete.cases(pasm4[ , time.var.4]), ]


ptmp4 <- pasm4_time[,c("Connect_ID","d_452942800","d_264644252")]
ptmp4$d_452942800 <- as.POSIXct(ymd_hms(ptmp4$d_452942800))
ptmp4$d_264644252 <- as.POSIXct(ymd_hms(ptmp4$d_264644252))


ptmp4$Mod4completionP <- difftime(ptmp4$d_264644252, ptmp4$d_452942800, units="mins")
summary(as.numeric(ptmp4$Mod4completionP))

round((100*(sum(ptmp4$Mod4completionP<10, na.rm=TRUE)/sum(passive_c$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp4$Mod4completionP & ptmp4$Mod4completionP>10, na.rm=TRUE)/sum(passive_c_before$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp4$Mod4completionP & ptmp4$Mod4completionP>20, na.rm=TRUE)/sum(passive_c_before$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp4$Mod4completionP>30, na.rm=TRUE)/sum(passive_c$d_663265240==231311385, na.rm=TRUE))), digits=2)

#Total
merm4= data_ccc_before %>% filter(data_ccc_before$d_663265240==231311385)
#merm4_time <- merm4[complete.cases(time.var.4)]
merm4_time<- merm4[complete.cases(merm4[ , time.var.4]), ]


Ttmp.4 <- merm4_time[,c("Connect_ID","d_452942800","d_264644252", 'd_512820379')]
Ttmp.4$d_452942800 <- as.POSIXct(ymd_hms(Ttmp.4$d_452942800))
Ttmp.4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp.4$d_264644252))


Ttmp.4$Mod4completionT_B <- difftime(Ttmp.4$d_264644252, Ttmp.4$d_452942800, units="mins")
summary(as.numeric(Ttmp.4$Mod4completionT_B))

round((100*(sum(Ttmp.4$Mod4completionT_B<10, na.rm=TRUE)/sum(data_ccc$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp.4$Mod4completionT_B & Ttmp.4$Mod4completionT_B>10, na.rm=TRUE)/sum(data_ccc_before$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp.4$Mod4completionT_B & Ttmp.4$Mod4completionT_B>20, na.rm=TRUE)/sum(data_ccc_before$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp.4$Mod4completionT_B>30, na.rm=TRUE)/sum(data_ccc$d_663265240==231311385, na.rm=TRUE))), digits=2)


#Make an automatic table
head(Ttmp.4)


Ttmp.4b= Ttmp.4 %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp.4b)

ccc4_b4= Ttmp.4b %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b4)

ccc4_b4= ccc4_b4 %>%  mutate(freq=if(!is.na(ccc4_b4$Connect_ID)){1})
head(ccc4_b4)
dim(ccc4_b4)[[1]]

ccc4_b4= ccc4_b4 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_b4)

ccc4_b4= ccc4_b4 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b4)

ccc4_b4$percentage= (ccc4_b4$freq/dim(ccc4_b4)[[1]])*100 
head(ccc4_b4) 

ccc4_b4$percentage.Active= (ccc4_b4$freq.Active/dim(ccc4_b4)[[1]])*100 
head(ccc4_b4)

ccc4_b4$percentage.Passive= (ccc4_b4$freq.Passive/dim(ccc4_b4)[[1]])*100 
head(ccc4_b4)

ccc4_b4 <- ccc4_b4[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_b4)



ccc4_b4 <- ccc4_b4 %>% mutate(time_frame=case_when(Mod4completionT_B<10  ~ "Completed in Under 10 Minutes",
                                               20>Mod4completionT_B & Mod4completionT_B>10  ~ "Completed in 10-20 minutes",
                                               30>Mod4completionT_B & Mod4completionT_B>20  ~ "Completed in 20-30 minutes",
                                               Mod4completionT_B>30 ~ "Completed in 30+ minutes"))
head(ccc4_b4)

ccc4_b4_summary <- ccc4_b4 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print4B <- gt(ccc4_b4_summary)                                                                              
gt_print4B


```

```{r, echo=FALSE}

cat("Active(n=", s4_4bA, ")")
summary(as.numeric(tmp.4$Mod4completionA))

cat("Passive(n=", s4_4bP, ")")
summary(as.numeric(ptmp4$Mod4completionP))

cat("Total(n=", s4_4bT, ")")
summary(as.numeric(Ttmp.4$Mod4completionT_B))
```

```{r, echo=FALSE, warning = FALSE}

ccc4_b4_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 4 Completion Time of Verified Participants (Before)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
  tab_footnote(
    footnote = "Verification completed prior to July 5,2022 when all modules became available in prod") %>%
  tab_spanner(
    label="Active",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
  summary_rows(
    #    groups= T, 
    columns =  c(freq.Active,freq.Passive, freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% 
  summary_rows(
    #    groups= T, 
    columns = c(percentage.Active, percentage.Passive),
    fns= list(
      Sum= ~sum(.))) %>%
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```


### On or after all modules available
```{r, include= FALSE, warning=FALSE}
##AFTER
#All participant totals, active total and passive total
sum(active_c_after$d_663265240==231311385, na.rm=TRUE)
sum(passive_c_after$d_663265240==231311385, na.rm=TRUE)
sum(data_ccc_after$d_663265240==231311385, na.rm=TRUE)

s4_4aA=sum(active_c_after$d_663265240==231311385, na.rm=TRUE)
s4_4aP=sum(passive_c_after$d_663265240==231311385, na.rm=TRUE)
s4_4aT=sum(data_ccc_after$d_663265240==231311385, na.rm=TRUE)

#Active
actm4= active_c_after %>% filter(active_c_after$d_663265240==231311385)
#actm4_time <- actm4[complete.cases(time.var.4)]
actm4_time<- actm4[complete.cases(actm4[ , time.var.4]), ]


tmp.4 <- actm4_time[,c("Connect_ID","d_452942800","d_264644252")]
tmp.4$d_452942800 <- as.POSIXct(ymd_hms(tmp.4$d_452942800))
tmp.4$d_264644252 <- as.POSIXct(ymd_hms(tmp.4$d_264644252))


tmp.4$Mod4completionA <- difftime(tmp.4$d_264644252, tmp.4$d_452942800, units="mins")
summary(as.numeric(tmp.4$Mod4completionA))

round((100*(sum(tmp.4$Mod4completionA<10, na.rm=TRUE)/sum(active_c$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp.4$Mod4completionA & tmp.4$Mod4completionA>10, na.rm=TRUE)/sum(active_c_after$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp.4$Mod4completionA & tmp.4$Mod4completionA>20, na.rm=TRUE)/sum(active_c_after$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp.4$Mod4completionA>30, na.rm=TRUE)/sum(active_c$d_663265240==231311385, na.rm=TRUE))), digits=2)


#Passive
pasm4= passive_c_after %>% filter(passive_c_after$d_663265240==231311385)
#pasm4_time <- pasm4[complete.cases(time.var.4)]
pasm4_time<- pasm4[complete.cases(pasm4[ , time.var.4]), ]


ptmp4 <- pasm4_time[,c("Connect_ID","d_452942800","d_264644252")]
ptmp4$d_452942800 <- as.POSIXct(ymd_hms(ptmp4$d_452942800))
ptmp4$d_264644252 <- as.POSIXct(ymd_hms(ptmp4$d_264644252))


ptmp4$Mod4completionP <- difftime(ptmp4$d_264644252, ptmp4$d_452942800, units="mins")
summary(as.numeric(ptmp4$Mod4completionP))

round((100*(sum(ptmp4$Mod4completionP<10, na.rm=TRUE)/sum(passive_c$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp4$Mod4completionP & ptmp4$Mod4completionP>10, na.rm=TRUE)/sum(passive_c_after$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp4$Mod4completionP & ptmp4$Mod4completionP>20, na.rm=TRUE)/sum(passive_c_after$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp4$Mod4completionP>30, na.rm=TRUE)/sum(passive_c$d_663265240==231311385, na.rm=TRUE))), digits=2)

#Total
merm4= data_ccc_after %>% filter(data_ccc_after$d_663265240==231311385)
#merm4_time <- merm4[complete.cases(time.var.4)]
merm4_time<- merm4[complete.cases(merm4[ , time.var.4]), ]


Ttmp.4 <- merm4_time[,c("Connect_ID","d_452942800","d_264644252", "d_512820379")]
Ttmp.4$d_452942800 <- as.POSIXct(ymd_hms(Ttmp.4$d_452942800))
Ttmp.4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp.4$d_264644252))


Ttmp.4$Mod4completionT_A <- difftime(Ttmp.4$d_264644252, Ttmp.4$d_452942800, units="mins")
summary(as.numeric(Ttmp.4$Mod4completionT_A))

round((100*(sum(Ttmp.4$Mod4completionT_A<10, na.rm=TRUE)/sum(data_ccc$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp.4$Mod4completionT_A & Ttmp.4$Mod4completionT_A>10, na.rm=TRUE)/sum(data_ccc_after$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp.4$Mod4completionT_A & Ttmp.4$Mod4completionT_A>20, na.rm=TRUE)/sum(data_ccc_after$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp.4$Mod4completionT_A>30, na.rm=TRUE)/sum(data_ccc$d_663265240==231311385, na.rm=TRUE))), digits=2)


#Make an automatic table
head(Ttmp.4)


Ttmp.4A= Ttmp.4 %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp.4A)

ccc4_a4= Ttmp.4A %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a4)

ccc4_a4= ccc4_a4 %>%  mutate(freq=if(!is.na(ccc4_a4$Connect_ID)){1})
head(ccc4_a4)
dim(ccc4_a4)[[1]]

ccc4_a4= ccc4_a4 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_a4)

ccc4_a4= ccc4_a4 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a4)

ccc4_a4$percentage= (ccc4_a4$freq/dim(ccc4_a4)[[1]])*100 
head(ccc4_a4) 

ccc4_a4$percentage.Active= (ccc4_a4$freq.Active/dim(ccc4_a4)[[1]])*100 
head(ccc4_a4)

ccc4_a4$percentage.Passive= (ccc4_a4$freq.Passive/dim(ccc4_a4)[[1]])*100 
head(ccc4_a4)

ccc4_a4 <- ccc4_a4[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_a4)



ccc4_a4 <- ccc4_a4 %>% mutate(time_frame=case_when(Mod4completionT_A<10  ~ "Completed in Under 10 Minutes",
                                                   20>Mod4completionT_A & Mod4completionT_A>10  ~ "Completed in 10-20 minutes",
                                                   30>Mod4completionT_A & Mod4completionT_A>20  ~ "Completed in 20-30 minutes",
                                                   Mod4completionT_A>30 ~ "Completed in 30+ minutes"))
head(ccc4_a4)


ccc4_a4_summary <- ccc4_a4 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print4A <- gt(ccc4_a4_summary)                                                                              
gt_print4A
```

```{r, echo=FALSE}

cat("Active(n=", s4_4aA, ")")
summary(as.numeric(tmp.4$Mod4completionA))

cat("Passive(n=", s4_4aP, ")")
summary(as.numeric(ptmp4$Mod4completionP))

cat("Total(n=", s4_4aT, ")")
summary(as.numeric(Ttmp.4$Mod4completionT_A))
```

```{r, echo=FALSE, warning = FALSE}
ccc4_a4_summary %>%  gt() %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = html("Module 4 Completion Time of Verified Participants (On or After)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**Number of participants (n)**"), freq.Passive = md("**Number of participants (n)**"), 
             freq = md("**Total Number of participants (N)**"), 
             percentage.Active = md("**Percentage of Participants**"), percentage.Passive = md("**Percentage of Participants**"), percentage= md("**Percentage of Participants**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all modules became available in prod") %>%
  tab_spanner(
    label="Active",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
  summary_rows(
    #    groups= T, 
    columns =  c(freq.Active,freq.Passive, freq, percentage),
    fns= list(
      Sum= ~sum(.)
    ), decimals=0) %>% 
  summary_rows(
    #    groups= T, 
    columns = c(percentage.Active, percentage.Passive),
    fns= list(
      Sum= ~sum(.))) %>%
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```
# 
# 5.	% Submission of surveys modules by active recruits who cannot be verified
```{r, include=FALSE}
# 5.	% Submission of surveys modules by active recruits who cannot be verified   
#d_512820379==486306141 <-- active

cannot_verify <- data_c %>% filter(d_821247024==219863910& d_512820379==486306141) #active
dim(cannot_verify)

cannot_verify_all <- data_c %>% filter(d_821247024==219863910) #all
dim(cannot_verify_all)
#Only 1 active_c participant that cannot be verified

#>No survey modules submitted
active_c_NV_NS <- data_c %>% filter(d_821247024==219863910 & d_512820379==486306141 & (d_949302066==972455046 | d_949302066==615768760) & (d_536735468==972455046 | d_536735468==615768760) &
                                      (d_976570371==972455046 | d_976570371==615768760) & (d_663265240==972455046| d_663265240==615768760))
dim(active_c_NV_NS)
dim(active_c_NV_NS)[[1]]/dim(cannot_verify)[[1]]

#>Any survey modules submitted
active_c_NV_SB <- data_c %>% filter(d_821247024==219863910 & d_512820379==486306141 & (d_949302066==231311385 | d_536735468==231311385 | d_976570371==231311385 | d_663265240==231311385))
dim(active_c_NV_SB)
dim(active_c_NV_SB)[[1]]/dim(cannot_verify)[[1]]
```

```{r, echo=FALSE}
cat("Number of Active Participants that cannot be verified:", dim(cannot_verify)[[1]])
cat("\n", "Percent of no Surveys Completed by these Participants (N=", dim(active_c_NV_NS)[[1]] ,")") 
cat("\t", 100*(dim(active_c_NV_NS)[[1]]/dim(cannot_verify)[[1]]), "%")
cat("\n" , "Percent Where at Least 1 Survey Completed by these Participants (N=", dim(active_c_NV_SB)[[1]] ,")")
cat("\t", (100*(dim(active_c_NV_SB)[[1]]/dim(cannot_verify)[[1]])), "%")
```


```{r, include=FALSE}

#######################################################################################################
##### ALL MODULES #####  
dim(data_ccc)






#6.	Time from start of Module 1 to completion of most recent module (in hours) to get overall averages --- review this code! Might have swapped all mod1 completions status with Mod 4, and Mod3 with Mod1

time.var.1_1 <- c("d_205553981","d_517311251")
mer1_1= data_ccc_after %>% filter(data_ccc_after$d_949302066==231311385 & (d_205553981>="2022-07-05"))
#mer1_2_time <- mer1_2[complete.cases(time.var.1_2)]
mer1_1_time<- mer1_1[complete.cases(mer1_1[ , time.var.1_1]), ]


Ttmp1_1 <- mer1_1_time[,c("Connect_ID","d_205553981","d_517311251")]
Ttmp1_1$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_1$d_205553981))
Ttmp1_1$d_517311251 <- as.POSIXct(ymd_hms(Ttmp1_1$d_517311251))


Ttmp1_1$Mod2completionT <- difftime(Ttmp1_1$d_517311251, Ttmp1_1$d_205553981, units="hours")
summary(as.numeric(Ttmp1_1$Mod2completionT))

#mod 1 and 2
time.var.1_2 <- c("d_205553981","d_832139544")
mer1_2= mer1_1 %>% filter(d_536735468==231311385 & d_976570371!=231311385 & d_663265240!=231311385)
#mer1_2_time <- mer1_2[complete.cases(time.var.1_2)]
mer1_2_time<- mer1_2[complete.cases(mer1_2[ , time.var.1_2]), ]


Ttmp1_2 <- mer1_2_time[,c("Connect_ID","d_205553981","d_832139544")]
Ttmp1_2$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_2$d_205553981))
Ttmp1_2$d_832139544 <- as.POSIXct(ymd_hms(Ttmp1_2$d_832139544))


Ttmp1_2$Mod2completionT <- difftime(Ttmp1_2$d_832139544, Ttmp1_2$d_205553981, units="hours")
summary(as.numeric(Ttmp1_2$Mod2completionT))



#mod 1 & 3
time.var.1_3 <- c("d_205553981","d_770257102")
merm1_3= mer1_1 %>% filter(d_536735468!=231311385 & d_976570371==231311385 & d_663265240!=231311385)
#merm1_3_time <- merm1_3[complete.cases(time.var.1_3)]
merm1_3_time<- merm1_3[complete.cases(merm1_3[ , time.var.1_3]), ]


Ttmp1_3 <- merm1_3_time[,c("Connect_ID","d_205553981","d_770257102")]
Ttmp1_3$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_3$d_205553981))
Ttmp1_3$d_770257102 <- as.POSIXct(ymd_hms(Ttmp1_3$d_770257102))


Ttmp1_3$Mod1_3completionT <- difftime(Ttmp1_3$d_770257102, Ttmp1_3$d_205553981, units="hours")
summary(as.numeric(Ttmp1_3$Mod1_3completionT))

#mod 1 & 4
time.var.1_4 <- c("d_205553981","d_264644252")
merm1_4= mer1_1 %>% filter(d_536735468!=231311385 & d_976570371!=231311385 & d_663265240==231311385)
#merm1_4_time <- merm1_4[complete.cases(time.var.1_4)]
merm1_4_time<- merm1_4[complete.cases(merm1_4[ , time.var.1_4]), ]


Ttmp.1_4 <- merm1_4_time[,c("Connect_ID","d_205553981","d_264644252")]
Ttmp.1_4$d_205553981 <- as.POSIXct(ymd_hms(Ttmp.1_4$d_205553981))
Ttmp.1_4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp.1_4$d_264644252))


Ttmp.1_4$Mod1_4completionT <- difftime(Ttmp.1_4$d_264644252, Ttmp.1_4$d_205553981, units="hours")
summary(as.numeric(Ttmp.1_4$Mod1_4completionT))


#mod 1, 2 & 3   
time.var.1_2_3 <- c("d_205553981","d_770257102")
merm1_2_3= mer1_1 %>% filter(d_536735468==231311385 & d_976570371==231311385 & d_663265240!=231311385 & d_832139544 < d_770257102)
#merm1_2_3_time <- merm1_2_3[complete.cases(time.var.1_2_3)]
merm1_2_3_time<- merm1_2_3[complete.cases(merm1_2_3[ , time.var.1_2_3]), ]


Ttmp1_2_3 <- merm1_2_3_time[,c("Connect_ID","d_205553981","d_770257102")]
Ttmp1_2_3$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_2_3$d_205553981))
Ttmp1_2_3$d_770257102 <- as.POSIXct(ymd_hms(Ttmp1_2_3$d_770257102))


Ttmp1_2_3$Mod1_2_3completionT <- difftime(Ttmp1_2_3$d_770257102, Ttmp1_2_3$d_205553981, units="hours")
summary(as.numeric(Ttmp1_2_3$Mod1_2_3completionT))

#mod 1, 3 & 2 (answering mod 3 before mod2)   
time.var.1_3_2 <- c("d_205553981","d_832139544")
merm1_3_2= mer1_1 %>% filter(d_536735468==231311385 & d_976570371==231311385 & d_663265240!=231311385 & d_770257102 < d_832139544)
#merm1_3_2_time <- merm1_3_2[complete.cases(time.var.1_3_2)]
merm1_3_2_time<- merm1_3_2[complete.cases(merm1_3_2[ , time.var.1_3_2]), ]


Ttmp1_3_2 <- merm1_3_2_time[,c("Connect_ID","d_205553981","d_832139544")]
Ttmp1_3_2$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_3_2$d_205553981))
Ttmp1_3_2$d_832139544 <- as.POSIXct(ymd_hms(Ttmp1_3_2$d_832139544))


Ttmp1_3_2$Mod1_3_2completionT <- difftime(Ttmp1_3_2$d_832139544, Ttmp1_3_2$d_205553981, units="hours")
summary(as.numeric(Ttmp1_3_2$Mod1_3_2completionT))


#mod 1, 2 & 4   
time.var.1_2_4 <- c("d_205553981","d_264644252")
merm1_2_4= mer1_1 %>% filter(d_536735468==231311385 & d_976570371!=231311385 & d_663265240==231311385 & d_832139544 < d_264644252)
#merm1_2_4_time <- merm1_2_4[complete.cases(time.var.1_2_4)]
merm1_2_4_time<- merm1_2_4[complete.cases(merm1_2_4[ , time.var.1_2_4]), ]


Ttmp1_2_4 <- merm1_2_4_time[,c("Connect_ID","d_205553981","d_264644252")]
Ttmp1_2_4$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_2_4$d_205553981))
Ttmp1_2_4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp1_2_4$d_264644252))


Ttmp1_2_4$Mod1_2_4completionT <- difftime(Ttmp1_2_4$d_264644252, Ttmp1_2_4$d_205553981, units="hours")
summary(as.numeric(Ttmp1_2_4$Mod1_2_4completionT))

#mod 1, 4 & 2 (answering 2 before four )   
time.var.1_4_2 <- c("d_205553981","d_832139544")
merm1_4_2= mer1_1 %>% filter(d_536735468==231311385 & d_976570371!=231311385 & d_663265240==231311385 & d_264644252 < d_832139544)
#merm1_4_2_time <- merm1_4_2[complete.cases(time.var.1_4_2)]
merm1_4_2_time<- merm1_4_2[complete.cases(merm1_4_2[ , time.var.1_4_2]), ]


Ttmp1_4_2 <- merm1_4_2_time[,c("Connect_ID","d_205553981","d_832139544")]
Ttmp1_4_2$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_4_2$d_205553981))
Ttmp1_4_2$d_832139544 <- as.POSIXct(ymd_hms(Ttmp1_4_2$d_832139544))


Ttmp1_4_2$Mod1_4_2completionT <- difftime(Ttmp1_4_2$d_832139544, Ttmp1_4_2$d_205553981, units="hours")
summary(as.numeric(Ttmp1_4_2$Mod1_4_2completionT))

#mod 1, 3 & 4 
time.var.1_3_4 <- c("d_205553981","d_264644252")
merm1_3_4= mer1_1 %>% filter(d_536735468!=231311385 & d_976570371==231311385 & d_663265240==231311385 & d_770257102 < d_264644252)
#merm1_3_4_time <- merm1_3_4[complete.cases(time.var.1_3_4)]
merm1_3_4_time<- merm1_3_4[complete.cases(merm1_3_4[ , time.var.1_3_4]), ]


Ttmp1_3_4 <- merm1_3_4_time[,c("Connect_ID","d_205553981","d_264644252")]
Ttmp1_3_4$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_3_4$d_205553981))
Ttmp1_3_4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp1_3_4$d_264644252))


Ttmp1_3_4$Mod1_3_4completionT <- difftime(Ttmp1_3_4$d_264644252, Ttmp1_3_4$d_205553981, units="hours")
summary(as.numeric(Ttmp1_3_4$Mod1_3_4completionT))

#mod 1, 4 & 3 
time.var.1_4_3 <- c("d_205553981","d_770257102")
merm1_4_3= mer1_1 %>% filter(d_536735468!=231311385 & d_976570371==231311385 & d_663265240==231311385 & d_264644252 < d_770257102)
#merm1_4_3_time <- merm1_4_3[complete.cases(time.var.1_4_3)]
merm1_4_3_time<- merm1_4_3[complete.cases(merm1_4_3[ , time.var.1_4_3]), ]


Ttmp1_4_3 <- merm1_4_3_time[,c("Connect_ID","d_205553981","d_770257102")]
Ttmp1_4_3$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_4_3$d_205553981))
Ttmp1_4_3$d_7702571022 <- as.POSIXct(ymd_hms(Ttmp1_4_3$d_770257102))


Ttmp1_4_3$Mod1_4_3completionT <- difftime(Ttmp1_4_3$d_770257102, Ttmp1_4_3$d_205553981, units="hours")
summary(as.numeric(Ttmp1_4_3$Mod1_4_3completionT))


#mod 1, 2, 3 & 4   ----- assuming in order
time.var.1_2_3_4 <- c("d_205553981","d_264644252")
merm1_2_3_4= mer1_1 %>% filter(d_536735468==231311385 & d_976570371==231311385 & d_663265240==231311385 & 
                                 d_517311251 < d_832139544 & d_832139544 < d_770257102 & d_770257102 < d_264644252)
#merm1_2_3_4_time <- merm1_2_3_4[complete.cases(time.var.1_2_3_4)]
merm1_2_3_4_time<- merm1_2_3_4[complete.cases(merm1_2_3_4[ , time.var.1_2_3_4]), ]


Ttmp1_2_3_4 <- merm1_2_3_4_time[,c("Connect_ID","d_205553981","d_264644252")]
Ttmp1_2_3_4$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_2_3_4$d_205553981))
Ttmp1_2_3_4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp1_2_3_4$d_264644252))


Ttmp1_2_3_4$Mod1_2_3_4completionT <- difftime(Ttmp1_2_3_4$d_264644252, Ttmp1_2_3_4$d_205553981, units="hours")
summary(as.numeric(Ttmp1_2_3_4$Mod1_2_3_4completionT))


```
# 
# 6.	Presence of survey completion time stamp, survey start time stamp, and survey completion flag for those who have completed a module. 
```{r, include=FALSE}
#M1
m1_cf=sum(data_ccc$d_949302066==231311385) #COMPLETION FLAGS
m1_done= data_ccc %>% filter(d_949302066==231311385)
m1_sts=sum(!is.na(m1_done$d_205553981)) #START TIME STAMP
m1_cts=sum(!is.na(m1_done$d_517311251)) #COMPLETION TIME STAMP

#M2
m2_cf=sum(data_ccc$d_536735468==231311385) #COMPLETION FLAGS
m2_done= data_ccc %>% filter(d_536735468==231311385)
m2_sts=sum(!is.na(m2_done$d_541836531)) #START TIME STAMP
m2_cts=sum(!is.na(m2_done$d_832139544)) #COMPLETION TIME STAMP

#M3
m3_cf=sum(data_ccc$d_976570371==231311385) #COMPLETION FLAGS
m3_done= data_ccc %>% filter(d_976570371==231311385)
m3_sts=sum(!is.na(m3_done$d_386488297)) #START TIME STAMP
m3_cts=sum(!is.na(m3_done$d_770257102)) #COMPLETION TIME STAMP

#M4
m4_cf=sum(data_ccc$d_663265240==231311385) #COMPLETION FLAGS
m4_done= data_ccc %>% filter(d_663265240==231311385)
m4_sts=sum(!is.na(m4_done$d_452942800)) #START TIME STAMP
m4_cts=sum(!is.na(m4_done$d_264644252)) #COMPLETION TIME STAMP

#B.U.M.
bum_cf=sum(data_ccc$d_265193023==231311385) #COMPLETION FLAGS
bum_done= data_ccc %>% filter(d_265193023==231311385)
bum_sts=sum(!is.na(bum_done$d_822499427)) #START TIME STAMP
bum_cts=sum(!is.na(bum_done$d_222161762)) #COMPLETION TIME STAMP
```

```{r, echo=FALSE}
#ifelse(m1_cf==m1_sts & m1_sts==m1_cts, "Module 1 completion flags, start time stamps and completion time stamps are all equal as they should be", cat(m1_cf, "Module 1 Completion Flags", sep="\n", m1_sts,"Module 1 Start Time Stamps",  m1_cts, "Module 1 Completion Time Stamps"  ))
cat("\t","Module 1 Completion Flags:", m1_cf)
cat("\t","Module 1 Start Time Stamps:", m1_sts)
cat("\t","Module 1 Completion Time Stamps:", m1_cts)
cat("\t",if(m1_cf!=m1_sts | m1_cts!=m1_sts | m1_cf!=m1_cts){"Not equal!!"})
cat("\n")

cat("\t", "Module 2 Completion Flags:", m2_cf)
cat("\t", "Module 2 Start Time Stamps:", m2_sts)
cat("\t", "Module 2 Completion Time Stamps:", m2_cts)
cat("\t",if(m2_cf!=m2_sts | m2_cts!=m2_sts | m2_cf!=m2_cts){"Not equal!!"})
cat("\n")

cat("\t","Module 3 Completion Flags:", m3_cf)
cat("\t","Module 3 Start Time Stamps:", m3_sts)
cat("\t","Module 3 Completion Time Stamps:", m3_cts)
cat("\t",if(m3_cf!=m3_sts | m3_cts!=m3_sts | m3_cf!=m3_cts){"Not equal!!"})
cat("\n")

cat("\t","Module 4 Completion Flags:", m4_cf)
cat("\t","Module 4 Start Time Stamps:", m4_sts)
cat("\t","Module 4 Completion Time Stamps:", m4_cts)
cat("\t",if(m4_cf!=m4_sts | m4_cts!=m4_sts | m4_cf!=m4_cts){"Not equal!!"})
cat("\n")

cat("\t","Blood Urine Mouthwash Survey Completion Flags:", bum_cf)
cat("\t","Blood Urine Mouthwash Survey Start Time Stamps:", bum_sts)
cat("\t","Blood Urine Mouthwash Survey Completion Time Stamps:", bum_cts)
cat("\t",if(bum_cf!=bum_sts | bum_cts!=bum_sts | bum_cf!=bum_cts){"Not equal!!"})


```
# 

# 7. Connect_IDs of those who completed the menstrual cycle survey
```{r, include=FALSE}
#8. Connect_IDs of those who completed the menstrual cycle survey---need to convert to SQL code since d_459098666 and D_299215535.D_112151599 are in participants table and aren't flattened

mens_ccc <- "SELECT Connect_ID,  d_265193023,  d_459098666
 FROM `nih-nci-dceg-connect-prod-6d04.Connect.participants` 
 where D_299215535.D_112151599='353358909' and
 d_265193023=231311385 "

mens_table_cc <- bq_project_query(project_cc, mens_ccc)
mens_data_ccc <- bq_table_download(mens_table_cc, bigint = "integer64")

menstrual <- mens_data_ccc
dim(menstrual)

mens_complete <- mens_data_ccc  %>%  filter(d_459098666==231311385 )
dim(mens_complete)
mens_complete

round(100*(dim(mens_complete)[[1]]/dim(menstrual)[[1]]), digits=2)

mens_complete$Connect_ID

```


```{r, echo=FALSE}
cat('Number of participants who have completed:', dim(mens_complete)[[1]])
cat('Number of participans who are eligiible:', dim(menstrual)[[1]])
cat('Percent completed:', round(100*(dim(mens_complete)[[1]]/dim(menstrual)[[1]]), digits=2), "%")
```

